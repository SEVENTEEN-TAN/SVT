# SVT å¾®æœåŠ¡æ¶æ„æ¼”è¿›è§„åˆ’

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

**æ–‡æ¡£æ ‡é¢˜**: SVTå¾®æœåŠ¡æ¶æ„æ¼”è¿›è§„åˆ’  
**åˆ›å»ºæ—¶é—´**: 2025-06-18 19:25:00 +08:00  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ä½œè€…**: Sun Wukong & Architecture Team  
**é€‚ç”¨ç‰ˆæœ¬**: SVT v1.0.0 â†’ v2.0.0  

## ğŸ¯ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è§„åˆ’äº†SVTé¡¹ç›®ä»å½“å‰å•ä½“æ¶æ„å‘å¾®æœåŠ¡æ¶æ„çš„æ¼”è¿›è·¯å¾„ï¼ŒåŒ…æ‹¬æœåŠ¡æ‹†åˆ†ç­–ç•¥ã€æŠ€æœ¯é€‰å‹ã€æ•°æ®è¿ç§»æ–¹æ¡ˆã€éƒ¨ç½²æ¶æ„ç­‰å…³é”®å†…å®¹ã€‚

## ğŸ—ï¸ å½“å‰æ¶æ„åˆ†æ

### ç°æœ‰å•ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SVT-Server (å•ä½“åº”ç”¨)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  ç”¨æˆ·ç®¡ç†    â”‚  â”‚  æƒé™ç®¡ç†    â”‚  â”‚  ç³»ç»Ÿé…ç½®    â”‚         â”‚
â”‚  â”‚  æ¨¡å—       â”‚  â”‚  æ¨¡å—       â”‚  â”‚  æ¨¡å—       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  ä¸šåŠ¡æ ¸å¿ƒ    â”‚  â”‚  æ–‡ä»¶ç®¡ç†    â”‚  â”‚  æ—¥å¿—å®¡è®¡    â”‚         â”‚
â”‚  â”‚  æ¨¡å—       â”‚  â”‚  æ¨¡å—       â”‚  â”‚  æ¨¡å—       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              AESåŠ å¯†ç³»ç»Ÿ (æ¨ªåˆ‡å…³æ³¨ç‚¹)                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å…±äº«æ•°æ®åº“     â”‚
                    â”‚  (SQL Server)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„é—®é¢˜åˆ†æ
```yaml
æŠ€æœ¯å€ºåŠ¡:
- å•ä½“åº”ç”¨éƒ¨ç½²å¤æ‚åº¦é«˜
- æ¨¡å—é—´è€¦åˆåº¦è¾ƒé«˜
- æ•°æ®åº“æˆä¸ºæ€§èƒ½ç“¶é¢ˆ
- æŠ€æœ¯æ ˆå‡çº§å›°éš¾

æ‰©å±•æ€§é—®é¢˜:
- æ— æ³•ç‹¬ç«‹æ‰©å±•å•ä¸ªæ¨¡å—
- èµ„æºåˆ©ç”¨ç‡ä¸å‡è¡¡
- æ–°åŠŸèƒ½å¼€å‘å½±å“æ•´ä½“ç¨³å®šæ€§

è¿ç»´æŒ‘æˆ˜:
- æ•…éšœå½±å“èŒƒå›´å¤§
- éƒ¨ç½²é£é™©é«˜
- ç›‘æ§ç²’åº¦ç²—ç³™
- å›¢é˜Ÿåä½œæ•ˆç‡ä½
```

## ğŸ¯ ç›®æ ‡å¾®æœåŠ¡æ¶æ„

### æœåŠ¡æ‹†åˆ†è®¾è®¡
```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   API Gateway   â”‚
                        â”‚   (Zuul/Gateway)â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                â”‚                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   ç”¨æˆ·è®¤è¯æœåŠ¡     â”‚ â”‚é…ç½®æœåŠ¡ â”‚ â”‚   ä¸šåŠ¡ç½‘å…³æœåŠ¡   â”‚
        â”‚ (Auth Service)    â”‚ â”‚(Config)â”‚ â”‚(Business Gateway)â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚               â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚               â”‚               â”‚             â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ç”¨æˆ·æœåŠ¡ â”‚ â”‚æƒé™æœåŠ¡   â”‚ â”‚   æ–‡ä»¶æœåŠ¡     â”‚ â”‚ä¸šåŠ¡æ ¸å¿ƒ   â”‚ â”‚å®¡è®¡æœåŠ¡â”‚
â”‚(User)  â”‚ â”‚(Auth)    â”‚ â”‚  (File)       â”‚ â”‚(Business) â”‚ â”‚(Audit) â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚            â”‚               â”‚               â”‚           â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ç”¨æˆ·DB  â”‚ â”‚æƒé™DB     â”‚ â”‚   æ–‡ä»¶å­˜å‚¨     â”‚ â”‚ä¸šåŠ¡DB     â”‚ â”‚å®¡è®¡DB  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæœåŠ¡å®šä¹‰

#### 1. ç”¨æˆ·è®¤è¯æœåŠ¡ (Auth Service)
```yaml
èŒè´£:
- JWT Token ç®¡ç†
- ç”¨æˆ·ç™»å½•/ç™»å‡º
- å¯†ç ç­–ç•¥ç®¡ç†
- å¤šå› å­è®¤è¯
- SSO é›†æˆ

æŠ€æœ¯æ ˆ:
- Spring Boot 3.x
- Spring Security 6.x
- Redis (Tokenç¼“å­˜)
- MySQL (ç”¨æˆ·æ•°æ®)

æ¥å£è®¾è®¡:
- POST /auth/login
- POST /auth/logout
- POST /auth/refresh
- GET /auth/userinfo
- POST /auth/change-password
```

#### 2. ç”¨æˆ·ç®¡ç†æœåŠ¡ (User Service)
```yaml
èŒè´£:
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- ç”¨æˆ·æ³¨å†Œ/æ³¨é”€
- ç”¨æˆ·èµ„æ–™ç»´æŠ¤
- ç”¨æˆ·çŠ¶æ€ç®¡ç†

æŠ€æœ¯æ ˆ:
- Spring Boot 3.x
- MyBatis-Flex
- MySQL
- Redis (ç¼“å­˜)

æ¥å£è®¾è®¡:
- GET /users/{id}
- POST /users
- PUT /users/{id}
- DELETE /users/{id}
- GET /users/search
```

#### 3. æƒé™ç®¡ç†æœåŠ¡ (Permission Service)
```yaml
èŒè´£:
- RBACæƒé™æ¨¡å‹
- è§’è‰²ç®¡ç†
- æƒé™åˆ†é…
- èµ„æºè®¿é—®æ§åˆ¶

æŠ€æœ¯æ ˆ:
- Spring Boot 3.x
- Spring Security
- MySQL
- Redis (æƒé™ç¼“å­˜)

æ¥å£è®¾è®¡:
- GET /permissions/user/{userId}
- POST /roles
- PUT /roles/{id}/permissions
- GET /resources/check
```

#### 4. é…ç½®ç®¡ç†æœåŠ¡ (Config Service)
```yaml
èŒè´£:
- é…ç½®ä¸­å¿ƒ
- ç¯å¢ƒé…ç½®ç®¡ç†
- åŠ¨æ€é…ç½®æ›´æ–°
- é…ç½®ç‰ˆæœ¬æ§åˆ¶

æŠ€æœ¯æ ˆ:
- Spring Cloud Config
- Git Repository
- MySQL (é…ç½®å†å²)

æ¥å£è®¾è®¡:
- GET /config/{service}/{profile}
- POST /config/refresh
- GET /config/history
```

#### 5. æ–‡ä»¶ç®¡ç†æœåŠ¡ (File Service)
```yaml
èŒè´£:
- æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½
- æ–‡ä»¶å­˜å‚¨ç®¡ç†
- æ–‡ä»¶æƒé™æ§åˆ¶
- æ–‡ä»¶é¢„è§ˆ/è½¬æ¢

æŠ€æœ¯æ ˆ:
- Spring Boot 3.x
- MinIO/OSS
- MySQL (æ–‡ä»¶å…ƒæ•°æ®)

æ¥å£è®¾è®¡:
- POST /files/upload
- GET /files/{id}/download
- DELETE /files/{id}
- GET /files/list
```

#### 6. ä¸šåŠ¡æ ¸å¿ƒæœåŠ¡ (Business Service)
```yaml
èŒè´£:
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- ä¸šåŠ¡æµç¨‹ç®¡ç†
- æ•°æ®å¤„ç†
- ä¸šåŠ¡è§„åˆ™å¼•æ“

æŠ€æœ¯æ ˆ:
- Spring Boot 3.x
- MyBatis-Flex
- MySQL
- Redis
- RabbitMQ

æ¥å£è®¾è®¡:
- æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€æ±‚å®šä¹‰
```

#### 7. å®¡è®¡æ—¥å¿—æœåŠ¡ (Audit Service)
```yaml
èŒè´£:
- æ“ä½œæ—¥å¿—è®°å½•
- å®¡è®¡è¿½è¸ª
- æ—¥å¿—æŸ¥è¯¢åˆ†æ
- åˆè§„æŠ¥å‘Š

æŠ€æœ¯æ ˆ:
- Spring Boot 3.x
- Elasticsearch
- Logstash
- Kibana

æ¥å£è®¾è®¡:
- POST /audit/log
- GET /audit/search
- GET /audit/reports
```

## ğŸ”„ æ¼”è¿›ç­–ç•¥

### Phase 1: åŸºç¡€è®¾æ–½å‡†å¤‡ (4-6å‘¨)

#### 1.1 æœåŠ¡æ³¨å†Œä¸å‘ç°
```yaml
æŠ€æœ¯é€‰å‹: Nacos / Consul
é…ç½®å†…å®¹:
- æœåŠ¡æ³¨å†Œä¸­å¿ƒæ­å»º
- å¥åº·æ£€æŸ¥é…ç½®
- è´Ÿè½½å‡è¡¡ç­–ç•¥
- æ•…éšœè½¬ç§»æœºåˆ¶

å®æ–½æ­¥éª¤:
1. æ­å»ºNacosé›†ç¾¤
2. é…ç½®æœåŠ¡å‘ç°å®¢æˆ·ç«¯
3. å®ç°å¥åº·æ£€æŸ¥
4. æµ‹è¯•æ•…éšœè½¬ç§»
```

#### 1.2 APIç½‘å…³
```yaml
æŠ€æœ¯é€‰å‹: Spring Cloud Gateway
åŠŸèƒ½ç‰¹æ€§:
- è·¯ç”±ç®¡ç†
- é™æµç†”æ–­
- è®¤è¯æˆæƒ
- è¯·æ±‚å“åº”è½¬æ¢
- ç›‘æ§æŒ‡æ ‡

é…ç½®ç¤ºä¾‹:
spring:
  cloud:
    gateway:
      routes:
      - id: user-service
        uri: lb://user-service
        predicates:
        - Path=/api/users/**
        filters:
        - StripPrefix=2
        - name: RequestRateLimiter
          args:
            redis-rate-limiter.replenishRate: 10
            redis-rate-limiter.burstCapacity: 20
```

#### 1.3 é…ç½®ä¸­å¿ƒ
```yaml
æŠ€æœ¯é€‰å‹: Spring Cloud Config + Nacos
é…ç½®ç®¡ç†:
- ç¯å¢ƒéš”ç¦»
- åŠ¨æ€åˆ·æ–°
- é…ç½®åŠ å¯†
- ç‰ˆæœ¬æ§åˆ¶

é…ç½®ç»“æ„:
config-repo/
â”œâ”€â”€ application.yml          # å…¬å…±é…ç½®
â”œâ”€â”€ user-service-dev.yml     # ç”¨æˆ·æœåŠ¡å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ user-service-prod.yml    # ç”¨æˆ·æœåŠ¡ç”Ÿäº§ç¯å¢ƒ
â””â”€â”€ gateway-prod.yml         # ç½‘å…³ç”Ÿäº§ç¯å¢ƒ
```

### Phase 2: æœåŠ¡æ‹†åˆ†å®æ–½ (6-8å‘¨)

#### 2.1 ç”¨æˆ·è®¤è¯æœåŠ¡æ‹†åˆ†
```java
// ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºç‹¬ç«‹çš„è®¤è¯æœåŠ¡
@SpringBootApplication
@EnableEurekaClient
public class AuthServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(AuthServiceApplication.class, args);
    }
}

// ç¬¬äºŒæ­¥ï¼šè¿ç§»è®¤è¯ç›¸å…³ä»£ç 
@RestController
@RequestMapping("/auth")
public class AuthController {
    
    @Autowired
    private AuthService authService;
    
    @PostMapping("/login")
    public ResponseEntity<LoginResponse> login(@RequestBody LoginRequest request) {
        // è®¤è¯é€»è¾‘
        return ResponseEntity.ok(authService.login(request));
    }
}

// ç¬¬ä¸‰æ­¥ï¼šé…ç½®ç‹¬ç«‹æ•°æ®åº“
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/svt_auth
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
```

#### 2.2 æ•°æ®åº“æ‹†åˆ†ç­–ç•¥
```yaml
æ‹†åˆ†åŸåˆ™:
- æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†
- é¿å…è·¨åº“äº‹åŠ¡
- ä¿æŒæ•°æ®ä¸€è‡´æ€§
- æ”¯æŒç‹¬ç«‹æ‰©å±•

æ‹†åˆ†æ–¹æ¡ˆ:
svt_auth:        # è®¤è¯æœåŠ¡æ•°æ®åº“
- users
- user_tokens
- login_logs

svt_permission:  # æƒé™æœåŠ¡æ•°æ®åº“
- roles
- permissions
- user_roles
- role_permissions

svt_business:    # ä¸šåŠ¡æœåŠ¡æ•°æ®åº“
- business_entities
- business_relations
- business_logs

svt_audit:       # å®¡è®¡æœåŠ¡æ•°æ®åº“
- audit_logs
- operation_records
```

#### 2.3 åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†
```yaml
æŠ€æœ¯é€‰å‹: Seata
äº‹åŠ¡æ¨¡å¼: ATæ¨¡å¼ (è‡ªåŠ¨è¡¥å¿)

é…ç½®ç¤ºä¾‹:
seata:
  enabled: true
  application-id: svt-business
  tx-service-group: svt-group
  registry:
    type: nacos
    nacos:
      server-addr: localhost:8848
      group: SEATA_GROUP
```

### Phase 3: æœåŠ¡é—´é€šä¿¡ (2-3å‘¨)

#### 3.1 åŒæ­¥é€šä¿¡
```java
// ä½¿ç”¨OpenFeignè¿›è¡ŒæœåŠ¡é—´è°ƒç”¨
@FeignClient(name = "user-service", fallback = UserServiceFallback.class)
public interface UserServiceClient {
    
    @GetMapping("/users/{id}")
    User getUserById(@PathVariable("id") Long id);
    
    @PostMapping("/users")
    User createUser(@RequestBody CreateUserRequest request);
}

// ç†”æ–­é™çº§å¤„ç†
@Component
public class UserServiceFallback implements UserServiceClient {
    
    @Override
    public User getUserById(Long id) {
        return User.builder()
            .id(id)
            .username("fallback-user")
            .build();
    }
}
```

#### 3.2 å¼‚æ­¥é€šä¿¡
```java
// ä½¿ç”¨RabbitMQè¿›è¡Œå¼‚æ­¥æ¶ˆæ¯ä¼ é€’
@Component
public class UserEventPublisher {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void publishUserCreated(User user) {
        UserCreatedEvent event = UserCreatedEvent.builder()
            .userId(user.getId())
            .username(user.getUsername())
            .timestamp(System.currentTimeMillis())
            .build();
            
        rabbitTemplate.convertAndSend("user.exchange", "user.created", event);
    }
}

// äº‹ä»¶ç›‘å¬å™¨
@RabbitListener(queues = "permission.user.created")
@Component
public class PermissionEventListener {
    
    @RabbitHandler
    public void handleUserCreated(UserCreatedEvent event) {
        // ä¸ºæ–°ç”¨æˆ·åˆ†é…é»˜è®¤æƒé™
        permissionService.assignDefaultPermissions(event.getUserId());
    }
}
```

### Phase 4: ç›‘æ§ä¸è¿ç»´ (2-3å‘¨)

#### 4.1 é“¾è·¯è¿½è¸ª
```yaml
æŠ€æœ¯é€‰å‹: Spring Cloud Sleuth + Zipkin
é…ç½®ç¤ºä¾‹:
spring:
  sleuth:
    zipkin:
      base-url: http://zipkin-server:9411
    sampler:
      probability: 1.0  # é‡‡æ ·ç‡100%ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```

#### 4.2 æŒ‡æ ‡ç›‘æ§
```yaml
æŠ€æœ¯é€‰å‹: Micrometer + Prometheus + Grafana
æŒ‡æ ‡ç±»å‹:
- ä¸šåŠ¡æŒ‡æ ‡: ç”¨æˆ·æ³¨å†Œæ•°ã€ç™»å½•æˆåŠŸç‡
- æŠ€æœ¯æŒ‡æ ‡: QPSã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡
- åŸºç¡€æŒ‡æ ‡: CPUã€å†…å­˜ã€ç½‘ç»œã€ç£ç›˜

é…ç½®ç¤ºä¾‹:
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
```

#### 4.3 æ—¥å¿—èšåˆ
```yaml
æŠ€æœ¯é€‰å‹: ELK Stack (Elasticsearch + Logstash + Kibana)
æ—¥å¿—æ ¼å¼:
{
  "timestamp": "2025-06-18T19:25:00.000Z",
  "level": "INFO",
  "service": "user-service",
  "traceId": "abc123",
  "spanId": "def456",
  "message": "ç”¨æˆ·ç™»å½•æˆåŠŸ",
  "userId": 12345,
  "ip": "192.168.1.100"
}
```

## ğŸ”’ AESåŠ å¯†ç³»ç»Ÿè¿ç§»

### å¾®æœåŠ¡ç¯å¢ƒä¸‹çš„åŠ å¯†ç­–ç•¥
```yaml
æŒ‘æˆ˜:
- å¤šæœåŠ¡é—´å¯†é’¥åŒæ­¥
- åŠ å¯†æ€§èƒ½å½±å“
- å¯†é’¥ç®¡ç†å¤æ‚åº¦

è§£å†³æ–¹æ¡ˆ:
1. ç»Ÿä¸€å¯†é’¥ç®¡ç†æœåŠ¡
2. ç½‘å…³å±‚ç»Ÿä¸€åŠ è§£å¯†
3. æœåŠ¡é—´æ˜æ–‡é€šä¿¡
```

#### åŠ å¯†æœåŠ¡è®¾è®¡
```java
@Service
public class CryptoService {
    
    @Autowired
    private KeyManagementService keyManagementService;
    
    /**
     * ç»Ÿä¸€åŠ å¯†æ¥å£
     */
    public String encrypt(String data, String keyId) {
        String key = keyManagementService.getKey(keyId);
        return AESUtil.encrypt(data, key);
    }
    
    /**
     * ç»Ÿä¸€è§£å¯†æ¥å£
     */
    public String decrypt(String encryptedData, String keyId) {
        String key = keyManagementService.getKey(keyId);
        return AESUtil.decrypt(encryptedData, key);
    }
}
```

#### ç½‘å…³å±‚åŠ å¯†å¤„ç†
```java
@Component
public class CryptoGatewayFilter implements GlobalFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        
        // è¯·æ±‚åŠ å¯†å¤„ç†
        if (needsDecryption(request)) {
            return decryptRequest(exchange, chain);
        }
        
        // å“åº”åŠ å¯†å¤„ç†
        return encryptResponse(exchange, chain);
    }
}
```

## ğŸ“Š æ•°æ®è¿ç§»æ–¹æ¡ˆ

### æ•°æ®è¿ç§»ç­–ç•¥
```yaml
è¿ç§»åŸåˆ™:
- é›¶åœæœºè¿ç§»
- æ•°æ®ä¸€è‡´æ€§ä¿è¯
- å›æ»šæœºåˆ¶å®Œå–„
- æ€§èƒ½å½±å“æœ€å°

è¿ç§»æ­¥éª¤:
1. åŒå†™é˜¶æ®µ - åŒæ—¶å†™å…¥æ–°æ—§æ•°æ®åº“
2. æ•°æ®åŒæ­¥ - å†å²æ•°æ®è¿ç§»
3. è¯»å†™åˆ‡æ¢ - é€æ­¥åˆ‡æ¢è¯»å†™æµé‡
4. æ¸…ç†é˜¶æ®µ - æ¸…ç†æ—§æ•°æ®å’Œä»£ç 
```

#### åŒå†™å®ç°
```java
@Service
@Transactional
public class UserMigrationService {
    
    @Autowired
    private UserRepository legacyUserRepository;
    
    @Autowired
    private UserServiceClient newUserServiceClient;
    
    public User createUser(CreateUserRequest request) {
        // å†™å…¥æ—§æ•°æ®åº“
        User legacyUser = legacyUserRepository.save(convertToLegacyUser(request));
        
        try {
            // å†™å…¥æ–°æœåŠ¡
            User newUser = newUserServiceClient.createUser(request);
            log.info("ç”¨æˆ·æ•°æ®åŒå†™æˆåŠŸ: legacyId={}, newId={}", legacyUser.getId(), newUser.getId());
            return newUser;
        } catch (Exception e) {
            log.error("æ–°æœåŠ¡å†™å…¥å¤±è´¥ï¼Œå›æ»šæ—§æ•°æ®: {}", e.getMessage());
            legacyUserRepository.delete(legacyUser);
            throw e;
        }
    }
}
```

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–

### æœåŠ¡é—´è°ƒç”¨ä¼˜åŒ–
```yaml
ä¼˜åŒ–ç­–ç•¥:
- è¿æ¥æ± å¤ç”¨
- è¯·æ±‚åˆå¹¶
- ç¼“å­˜ç­–ç•¥
- å¼‚æ­¥å¤„ç†

è¿æ¥æ± é…ç½®:
feign:
  httpclient:
    enabled: true
    max-connections: 200
    max-connections-per-route: 50
    connection-timeout: 2000
    socket-timeout: 10000
```

### ç¼“å­˜ç­–ç•¥
```java
@Service
public class UserCacheService {
    
    @Cacheable(value = "users", key = "#id")
    public User getUserById(Long id) {
        return userServiceClient.getUserById(id);
    }
    
    @CacheEvict(value = "users", key = "#user.id")
    public void updateUser(User user) {
        userServiceClient.updateUser(user);
    }
}
```

## ğŸ”„ éƒ¨ç½²æ¶æ„

### Kubernetes éƒ¨ç½²é…ç½®
```yaml
# user-service-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: user-service
  template:
    metadata:
      labels:
        app: user-service
    spec:
      containers:
      - name: user-service
        image: svt/user-service:latest
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "k8s"
        - name: NACOS_SERVER
          value: "nacos-service:8848"
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 30
        readinessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
```

### æœåŠ¡ç½‘æ ¼é›†æˆ
```yaml
# Istioé…ç½®ç¤ºä¾‹
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: user-service
spec:
  http:
  - match:
    - uri:
        prefix: /api/users
    route:
    - destination:
        host: user-service
        subset: v1
      weight: 90
    - destination:
        host: user-service
        subset: v2
      weight: 10
    fault:
      delay:
        percentage:
          value: 0.1
        fixedDelay: 5s
```

## ğŸ“ˆ å®æ–½æ—¶é—´è¡¨

### è¯¦ç»†æ—¶é—´è§„åˆ’
```yaml
Phase 1: åŸºç¡€è®¾æ–½å‡†å¤‡ (4-6å‘¨)
Week 1-2: 
- Nacosé›†ç¾¤æ­å»º
- APIç½‘å…³é…ç½®
- é…ç½®ä¸­å¿ƒæ­å»º

Week 3-4:
- ç›‘æ§ç³»ç»Ÿæ­å»º
- æ—¥å¿—èšåˆé…ç½®
- é“¾è·¯è¿½è¸ªé›†æˆ

Week 5-6:
- å¼€å‘ç¯å¢ƒéªŒè¯
- è‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™
- æ–‡æ¡£å®Œå–„

Phase 2: æœåŠ¡æ‹†åˆ†å®æ–½ (6-8å‘¨)
Week 7-8:
- ç”¨æˆ·è®¤è¯æœåŠ¡æ‹†åˆ†
- æ•°æ®åº“æ‹†åˆ†è®¾è®¡
- åŒå†™æœºåˆ¶å®ç°

Week 9-10:
- æƒé™ç®¡ç†æœåŠ¡æ‹†åˆ†
- æœåŠ¡é—´é€šä¿¡æµ‹è¯•
- äº‹åŠ¡å¤„ç†éªŒè¯

Week 11-12:
- æ–‡ä»¶ç®¡ç†æœåŠ¡æ‹†åˆ†
- ä¸šåŠ¡æœåŠ¡æ‹†åˆ†
- é›†æˆæµ‹è¯•

Week 13-14:
- å®¡è®¡æœåŠ¡æ‹†åˆ†
- æ€§èƒ½æµ‹è¯•
- å®‰å…¨æµ‹è¯•

Phase 3: ç”Ÿäº§éƒ¨ç½² (2-3å‘¨)
Week 15-16:
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- æ•°æ®è¿ç§»æ‰§è¡Œ
- ç›‘æ§é…ç½®

Week 17:
- æµé‡åˆ‡æ¢
- æ€§èƒ½éªŒè¯
- é—®é¢˜ä¿®å¤

Phase 4: ä¼˜åŒ–å®Œå–„ (æŒç»­)
- æ€§èƒ½ä¼˜åŒ–
- åŠŸèƒ½å¢å¼º
- è¿ç»´è‡ªåŠ¨åŒ–
```

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### æŠ€æœ¯æŒ‡æ ‡
```yaml
æ€§èƒ½æŒ‡æ ‡:
- æœåŠ¡å“åº”æ—¶é—´: <200ms (P95)
- ç³»ç»Ÿå¯ç”¨æ€§: >99.9%
- é”™è¯¯ç‡: <0.1%
- ååé‡: æå‡50%

è¿ç»´æŒ‡æ ‡:
- éƒ¨ç½²é¢‘ç‡: æ¯æ—¥å¤šæ¬¡
- æ•…éšœæ¢å¤æ—¶é—´: <5åˆ†é’Ÿ
- å˜æ›´å¤±è´¥ç‡: <5%
- ç›‘æ§è¦†ç›–ç‡: 100%
```

### ä¸šåŠ¡æŒ‡æ ‡
```yaml
å¼€å‘æ•ˆç‡:
- æ–°åŠŸèƒ½å¼€å‘å‘¨æœŸ: ç¼©çŸ­30%
- ä»£ç å¤ç”¨ç‡: æå‡40%
- å›¢é˜Ÿå¹¶è¡Œå¼€å‘èƒ½åŠ›: æå‡100%

è´¨é‡æŒ‡æ ‡:
- ä»£ç è¦†ç›–ç‡: >80%
- ç¼ºé™·å¯†åº¦: é™ä½50%
- ç”¨æˆ·æ»¡æ„åº¦: >95%
```

## ğŸ”„ é£é™©è¯„ä¼°ä¸åº”å¯¹

### ä¸»è¦é£é™©
```yaml
æŠ€æœ¯é£é™©:
- åˆ†å¸ƒå¼äº‹åŠ¡å¤æ‚æ€§
- æ•°æ®ä¸€è‡´æ€§é—®é¢˜
- ç½‘ç»œå»¶è¿Ÿå½±å“
- æœåŠ¡ä¾èµ–é“¾è¿‡é•¿

åº”å¯¹æªæ–½:
- æœ€ç»ˆä¸€è‡´æ€§è®¾è®¡
- è¡¥å¿äº‹åŠ¡æœºåˆ¶
- æœåŠ¡é™çº§ç­–ç•¥
- ä¾èµ–å…³ç³»ä¼˜åŒ–

ä¸šåŠ¡é£é™©:
- ç”¨æˆ·ä½“éªŒå½±å“
- æ•°æ®ä¸¢å¤±é£é™©
- æœåŠ¡ä¸å¯ç”¨
- æ€§èƒ½ä¸‹é™

åº”å¯¹æªæ–½:
- ç°åº¦å‘å¸ƒç­–ç•¥
- æ•°æ®å¤‡ä»½æœºåˆ¶
- ç†”æ–­é™çº§
- æ€§èƒ½ç›‘æ§å‘Šè­¦
```

### å›æ»šç­–ç•¥
```yaml
å›æ»šè§¦å‘æ¡ä»¶:
- é”™è¯¯ç‡è¶…è¿‡é˜ˆå€¼
- å“åº”æ—¶é—´æ˜¾è‘—å¢åŠ 
- å…³é”®åŠŸèƒ½ä¸å¯ç”¨
- æ•°æ®ä¸ä¸€è‡´

å›æ»šæ­¥éª¤:
1. ç«‹å³åœæ­¢æ–°ç‰ˆæœ¬éƒ¨ç½²
2. åˆ‡æ¢æµé‡åˆ°æ—§ç‰ˆæœ¬
3. æ•°æ®çŠ¶æ€æ£€æŸ¥å’Œä¿®å¤
4. é—®é¢˜åˆ†æå’Œä¿®å¤
5. é‡æ–°æµ‹è¯•å’Œéƒ¨ç½²
```

## ğŸ“ ç›¸å…³èµ„æº

### æŠ€æœ¯æ–‡æ¡£
- **[Spring Cloudå®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-cloud)**
- **[Kuberneteså®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/)**
- **[å¾®æœåŠ¡æ¶æ„æ¨¡å¼](https://microservices.io/)**

### æœ€ä½³å®è·µ
- **[12-Factor App](https://12factor.net/)**
- **[å¾®æœåŠ¡è®¾è®¡æ¨¡å¼](https://microservices.io/patterns/)**
- **[åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡](https://www.oreilly.com/library/view/designing-distributed-systems/9781491983638/)**

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æœ€åæ›´æ–°**: 2025-06-18 19:25:00 +08:00  
**ä¸‹æ¬¡å®¡æ ¸**: 2025-07-18 