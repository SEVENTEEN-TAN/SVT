# SVT å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

**æ–‡æ¡£æ ‡é¢˜**: SVTå®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ  
**åˆ›å»ºæ—¶é—´**: 2025-06-18 19:15:30 +08:00  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ä½œè€…**: Sun Wukong & DevOps Team  
**é€‚ç”¨ç‰ˆæœ¬**: SVT v1.0.0  

## ğŸ¯ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è§„åˆ’äº†SVTé¡¹ç›®çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆï¼ŒåŒ…æ‹¬Dockeré…ç½®ã€å¯†é’¥ç®¡ç†ã€ç½‘ç»œæ¶æ„ã€ç›‘æ§ä½“ç³»ç­‰å…³é”®æŠ€æœ¯è¦ç‚¹ã€‚

## ğŸ“‹ å½“å‰é¡¹ç›®çŠ¶æ€åˆ†æ

### âœ… å·²å®Œæˆçš„éƒ¨åˆ†
- å®Œæ•´çš„AESåŠ å¯†ç³»ç»Ÿ
- å‰åç«¯åˆ†ç¦»æ¶æ„
- å¤šç¯å¢ƒé…ç½®æ”¯æŒ
- å®Œæ•´çš„æ–‡æ¡£ä½“ç³»
- å®‰å…¨ç‰¹æ€§ï¼ˆArgon2ã€Jasyptã€JWTï¼‰

### ğŸ”„ å¾…å®Œæˆäº‹é¡¹

#### é«˜ä¼˜å…ˆçº§ â­â­â­â­â­
1. **å¯†é’¥ç®¡ç†ç­–ç•¥è®¾è®¡** - å®¹å™¨åŒ–çš„åŸºç¡€
2. **å¥åº·æ£€æŸ¥ç«¯ç‚¹å®Œå–„** - ç¡®ä¿å®¹å™¨å¯é æ€§
3. **æ—¥å¿—é…ç½®ä¼˜åŒ–** - ä¾¿äºå®¹å™¨ç¯å¢ƒè°ƒè¯•
4. **è¯·æ±‚ä½“è„±æ•å¤„ç†** - æ—¥å¿—å®‰å…¨

#### ä¸­ä¼˜å…ˆçº§ â­â­â­
1. **Docker Compose é…ç½®ç¼–å†™**
2. **CI/CD æµæ°´çº¿æ­å»º**
3. **ç›‘æ§æŒ‡æ ‡æš´éœ²**
4. **å¾®æœåŠ¡æ¶æ„æ¼”è¿›è§„åˆ’**

#### ä½ä¼˜å…ˆçº§ â­â­
1. **Kubernetes é…ç½®å‡†å¤‡**
2. **æœåŠ¡ç½‘æ ¼è€ƒè™‘**
3. **å¤šäº‘éƒ¨ç½²ç­–ç•¥**

## ğŸ³ å®¹å™¨åŒ–æ¶æ„è®¾è®¡

### ç½‘ç»œæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx/Traefik â”‚    â”‚   SVT-Web       â”‚    â”‚   SVT-Server    â”‚
â”‚   (åå‘ä»£ç†)     â”‚â—„â”€â”€â–ºâ”‚   (å‰ç«¯å®¹å™¨)     â”‚â—„â”€â”€â–ºâ”‚   (åç«¯å®¹å™¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Redis         â”‚â—„â”€â”€â–ºâ”‚   SQL Server    â”‚
                       â”‚   (ç¼“å­˜å®¹å™¨)     â”‚    â”‚   (æ•°æ®åº“å®¹å™¨)   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®¹å™¨ç»„ä»¶è§„åˆ’

| ç»„ä»¶ | é•œåƒ | ç«¯å£ | èµ„æºéœ€æ±‚ | è¯´æ˜ |
|------|------|------|----------|------|
| **å‰ç«¯** | nginx:alpine | 80 | 256MB/0.2CPU | é™æ€æ–‡ä»¶æœåŠ¡ |
| **åç«¯** | openjdk:17-jre-slim | 8080 | 1GB/0.5CPU | Spring Bootåº”ç”¨ |
| **æ•°æ®åº“** | mssql/server:2019 | 1433 | 2GB/1CPU | SQL Server |
| **ç¼“å­˜** | redis:7-alpine | 6379 | 512MB/0.2CPU | Redisç¼“å­˜ |
| **ä»£ç†** | nginx:alpine | 443 | 256MB/0.1CPU | SSLç»ˆæ­¢/è´Ÿè½½å‡è¡¡ |

## ğŸ”’ å¯†é’¥ç®¡ç†æ–¹æ¡ˆ

### 1. JASYPTå¯†é’¥ç®¡ç†

#### é—®é¢˜åˆ†æ
```yaml
å½“å‰æŒ‘æˆ˜:
- JASYPT_ENCRYPTOR_PASSWORD éœ€è¦åœ¨å®¹å™¨å¯åŠ¨æ—¶å¯ç”¨
- ä¸èƒ½ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨é•œåƒä¸­
- éœ€è¦æ”¯æŒå¯†é’¥è½®æ¢
- å¤šç¯å¢ƒå¯†é’¥éš”ç¦»
```

#### æ¨èæ–¹æ¡ˆ
```yaml
# Docker Secrets æ–¹æ¡ˆ
version: '3.8'
services:
  svt-server:
    image: svt-server:latest
    environment:
      - JASYPT_ENCRYPTOR_PASSWORD_FILE=/run/secrets/jasypt_password
    secrets:
      - jasypt_password

secrets:
  jasypt_password:
    external: true
```

#### Kubernetes æ–¹æ¡ˆ
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: jasypt-secret
type: Opaque
data:
  password: <base64-encoded-password>
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: svt-server
spec:
  template:
    spec:
      containers:
      - name: svt-server
        env:
        - name: JASYPT_ENCRYPTOR_PASSWORD
          valueFrom:
            secretKeyRef:
              name: jasypt-secret
              key: password
```

### 2. AESå¯†é’¥ç®¡ç†

#### å®¹å™¨ç¯å¢ƒç‰¹æ®Šè€ƒè™‘
```yaml
æŒ‘æˆ˜:
- å‰åç«¯AESå¯†é’¥åŒæ­¥
- å¯†é’¥ç‰ˆæœ¬ç®¡ç†
- å®¹å™¨é‡å¯åå¯†é’¥ä¸€è‡´æ€§

è§£å†³æ–¹æ¡ˆ:
1. ä½¿ç”¨å¤–éƒ¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆHashiCorp Vaultï¼‰
2. å®ç°å¯†é’¥ç‰ˆæœ¬æ§åˆ¶
3. æ”¯æŒåŠ¨æ€å¯†é’¥æ›´æ–°
```

## ğŸ“¦ Docker é…ç½®

### åç«¯ Dockerfile
```dockerfile
# å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–
FROM maven:3.9-openjdk-17 AS builder
WORKDIR /app
COPY pom.xml .
RUN mvn dependency:go-offline -B
COPY src ./src
RUN mvn clean package -DskipTests

FROM openjdk:17-jre-slim
RUN addgroup --system svt && adduser --system --group svt
WORKDIR /app
COPY --from=builder /app/target/*.jar app.jar
RUN chown svt:svt app.jar
USER svt

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=60s --retries=3 \
  CMD curl -f http://localhost:8080/actuator/health || exit 1

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

### å‰ç«¯ Dockerfile
```dockerfile
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
```

### Docker Compose å®Œæ•´é…ç½®
```yaml
version: '3.8'

services:
  svt-web:
    build: ./SVT-Web
    ports:
      - "80:80"
    depends_on:
      - svt-server
    networks:
      - svt-network

  svt-server:
    build: ./SVT-Server
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - JASYPT_ENCRYPTOR_PASSWORD_FILE=/run/secrets/jasypt_password
    depends_on:
      - redis
      - sqlserver
    secrets:
      - jasypt_password
    networks:
      - svt-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  redis:
    image: redis:7-alpine
    command: redis-server --requirepass ${REDIS_PASSWORD}
    volumes:
      - redis_data:/data
    networks:
      - svt-network

  sqlserver:
    image: mcr.microsoft.com/mssql/server:2019-latest
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${DB_PASSWORD}
    volumes:
      - sqlserver_data:/var/opt/mssql
    networks:
      - svt-network

volumes:
  redis_data:
  sqlserver_data:

networks:
  svt-network:
    driver: bridge

secrets:
  jasypt_password:
    external: true
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—æ–¹æ¡ˆ

### ç›‘æ§æ ˆé…ç½®
```yaml
# æ¨èçš„ç›‘æ§æ ˆ
version: '3.8'
services:
  prometheus:
    image: prom/prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"
    networks:
      - monitoring

  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    networks:
      - monitoring

  loki:
    image: grafana/loki
    ports:
      - "3100:3100"
    networks:
      - monitoring

  promtail:
    image: grafana/promtail
    volumes:
      - /var/log:/var/log:ro
    networks:
      - monitoring

networks:
  monitoring:
    driver: bridge
```

### åº”ç”¨æŒ‡æ ‡æš´éœ²
```yaml
# Spring Boot Actuator é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
```

## ğŸ”„ CI/CD æµæ°´çº¿

### GitHub Actions é…ç½®
```yaml
name: SVT CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
    
    - name: Run backend tests
      run: |
        cd SVT-Server
        mvn test
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Run frontend tests
      run: |
        cd SVT-Web
        npm ci
        npm test

  build-and-push:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Build and push Docker images
      run: |
        docker build -t svt-server:latest ./SVT-Server
        docker build -t svt-web:latest ./SVT-Web
        # Push to registry
```

## â˜¸ï¸ Kubernetes éƒ¨ç½²é…ç½®

### åç«¯éƒ¨ç½²é…ç½®
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: svt-server
  labels:
    app: svt-server
spec:
  replicas: 3
  selector:
    matchLabels:
      app: svt-server
  template:
    metadata:
      labels:
        app: svt-server
    spec:
      containers:
      - name: svt-server
        image: svt-server:latest
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
        - name: JASYPT_ENCRYPTOR_PASSWORD
          valueFrom:
            secretKeyRef:
              name: jasypt-secret
              key: password
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 30
        readinessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
```

### æœåŠ¡é…ç½®
```yaml
apiVersion: v1
kind: Service
metadata:
  name: svt-server-service
spec:
  selector:
    app: svt-server
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
  type: ClusterIP
```

## ğŸ›¡ï¸ å®‰å…¨é…ç½®

### ç½‘ç»œå®‰å…¨
```yaml
# ç½‘ç»œç­–ç•¥ç¤ºä¾‹
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: svt-network-policy
spec:
  podSelector:
    matchLabels:
      app: svt-server
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: svt-web
    ports:
    - protocol: TCP
      port: 8080
```

### å®¹å™¨å®‰å…¨
```dockerfile
# å®‰å…¨æœ€ä½³å®è·µ
FROM openjdk:17-jre-slim

# åˆ›å»ºérootç”¨æˆ·
RUN addgroup --system svt && adduser --system --group svt

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶åº”ç”¨æ–‡ä»¶
COPY --chown=svt:svt app.jar .

# åˆ‡æ¢åˆ°érootç”¨æˆ·
USER svt

# åªæš´éœ²å¿…è¦ç«¯å£
EXPOSE 8080

# ä½¿ç”¨execå½¢å¼çš„ENTRYPOINT
ENTRYPOINT ["java", "-jar", "app.jar"]
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### JVM å‚æ•°ä¼˜åŒ–
```bash
# å®¹å™¨ç¯å¢ƒJVMå‚æ•°
JAVA_OPTS="-Xms512m -Xmx1g -XX:+UseG1GC -XX:+UseContainerSupport"
```

### æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
```

## ğŸ”„ å¾®æœåŠ¡æ¼”è¿›è§„åˆ’

### å½“å‰å•ä½“æ¶æ„
```
SVT-Server (å•ä½“åº”ç”¨)
â”œâ”€â”€ ç”¨æˆ·ç®¡ç†æ¨¡å—
â”œâ”€â”€ æƒé™ç®¡ç†æ¨¡å—
â”œâ”€â”€ ç³»ç»Ÿé…ç½®æ¨¡å—
â””â”€â”€ ä¸šåŠ¡æ ¸å¿ƒæ¨¡å—
```

### ç›®æ ‡å¾®æœåŠ¡æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æœåŠ¡       â”‚  â”‚   æƒé™æœåŠ¡       â”‚  â”‚   é…ç½®æœåŠ¡       â”‚
â”‚   (User Service) â”‚  â”‚ (Auth Service)  â”‚  â”‚ (Config Service)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   APIç½‘å…³       â”‚
                    â”‚  (API Gateway)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ä¸šåŠ¡æœåŠ¡       â”‚
                    â”‚(Business Service)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¾®æœåŠ¡æ‹†åˆ†ç­–ç•¥
```yaml
ç¬¬ä¸€é˜¶æ®µ - å‚ç›´æ‹†åˆ†:
- ç”¨æˆ·è®¤è¯æœåŠ¡ç‹¬ç«‹
- é…ç½®ç®¡ç†æœåŠ¡ç‹¬ç«‹
- ä¿æŒæ ¸å¿ƒä¸šåŠ¡é€»è¾‘

ç¬¬äºŒé˜¶æ®µ - æ°´å¹³æ‹†åˆ†:
- æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†æ ¸å¿ƒæœåŠ¡
- å¼•å…¥æœåŠ¡ç½‘æ ¼
- å®ç°åˆ†å¸ƒå¼äº‹åŠ¡

ç¬¬ä¸‰é˜¶æ®µ - ä¼˜åŒ–å®Œå–„:
- æœåŠ¡æ²»ç†
- é“¾è·¯è¿½è¸ª
- ç†”æ–­é™çº§
```

## ğŸ“ å®æ–½è®¡åˆ’

### Phase 1: å®¹å™¨åŒ–åŸºç¡€ (2-3å‘¨)
- [ ] Dockeré…ç½®æ–‡ä»¶ç¼–å†™
- [ ] å¯†é’¥ç®¡ç†æ–¹æ¡ˆå®æ–½
- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹å®Œå–„
- [ ] æœ¬åœ°å®¹å™¨ç¯å¢ƒéªŒè¯

### Phase 2: CI/CDé›†æˆ (2å‘¨)
- [ ] GitHub Actionsæµæ°´çº¿æ­å»º
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•é›†æˆ
- [ ] é•œåƒæ„å»ºå’Œæ¨é€
- [ ] ç¯å¢ƒè‡ªåŠ¨éƒ¨ç½²

### Phase 3: ç”Ÿäº§éƒ¨ç½² (2-3å‘¨)
- [ ] Kubernetesé…ç½®ç¼–å†™
- [ ] ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿéƒ¨ç½²
- [ ] å®‰å…¨ç­–ç•¥å®æ–½
- [ ] ç”Ÿäº§ç¯å¢ƒéªŒè¯

### Phase 4: å¾®æœåŠ¡æ¼”è¿› (é•¿æœŸ)
- [ ] æœåŠ¡æ‹†åˆ†è®¾è®¡
- [ ] æ•°æ®åº“æ‹†åˆ†ç­–ç•¥
- [ ] åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ
- [ ] æœåŠ¡æ²»ç†å¹³å°

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡æ¡£
- **[Dockerå®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)**
- **[Kuberneteså®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/)**
- **[Spring Bootå®¹å™¨åŒ–æŒ‡å—](https://spring.io/guides/gs/spring-boot-docker/)**

### å·¥å…·æ¨è
- **å®¹å™¨ç¼–æ’**: Docker Compose, Kubernetes
- **é•œåƒä»“åº“**: Docker Hub, Harbor, AWS ECR
- **ç›‘æ§**: Prometheus + Grafana
- **æ—¥å¿—**: ELK Stack, Loki + Grafana
- **å¯†é’¥ç®¡ç†**: HashiCorp Vault, AWS Secrets Manager

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æœ€åæ›´æ–°**: 2025-06-18 19:15:30 +08:00  
**ä¸‹æ¬¡å®¡æ ¸**: 2025-07-18