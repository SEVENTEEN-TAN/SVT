# SVT_AES加密方案需求分析

**项目ID**: SVT-Management-System  
**任务文件名**: SVT_AES加密方案需求分析_2025-06-17.md  
**创建时间**: 2025-06-17 14:22:29 +08:00  
**创建者**: Sun Wukong (AI架构师)  
**关联协议**: RIPER-5 v4.1

## 需求背景

用户要求为SVT管理系统的前后端通信添加AES加密功能，并且需要通过配置文件进行控制。注意：这里的AES加密是专门用于API请求响应的加密，与现有的SM4密码加密是独立的两套加密体系。

## 核心需求

1. **前后端通信加密**: 所有API请求和响应数据进行AES加密
2. **配置文件控制**: 通过配置文件动态控制AES加密开关
3. **密钥管理**: 支持开发和生产环境的密钥管理
4. **与现有系统集成**: 不影响现有的SM4密码加密功能

## 技术要求

- **加密算法**: AES-256-CBC
- **前端实现**: crypto-js
- **后端实现**: Java Cipher
- **配置管理**: 环境变量 + 配置文件
- **开关控制**: 支持动态启用/禁用

## 当前实现状态

### ✅ 已完成组件

#### 1. 前端实现
- **加密工具类**: `SVT-Web/src/utils/crypto.ts` - 完整的AES加密解密功能
- **配置管理**: `SVT-Web/src/config/crypto.ts` - 统一配置管理
- **管理面板**: `SVT-Web/src/components/Common/CryptoConfigPanel.tsx` - 可视化配置管理
- **环境配置**: 
  - `SVT-Web/.env.development` - 开发环境配置(已集成AES配置)
  - `SVT-Web/.env.production` - 生产环境配置(已集成AES配置)
  - `SVT-Web/env.example` - 配置模板和说明

#### 2. 后端实现
- **加密工具类**: `SVT-Server/src/main/java/com/seventeen/svt/common/util/AESUtils.java`
- **配置类**: `SVT-Server/src/main/java/com/seventeen/svt/common/config/AESConfig.java`
- **主配置文件**: `SVT-Server/src/main/resources/application.yml` - 已添加完整AES配置
- **开发环境配置**: `SVT-Server/src/main/resources/application-dev.yml` - 已添加开发环境AES配置

#### 3. 文档和架构
- **架构设计**: `project_document/architecture/SVT_AES加密架构方案_v1.0.md`
- **配置说明**: `SVT-Web/docs/AES加密配置说明.md`

### 🔧 配置文件控制实现

#### 前端配置控制
**开发环境** (`.env.development`):
```bash
VITE_AES_ENABLED=true
VITE_AES_KEY=SVT-DEFAULT-AES-KEY-256BITS-FOR-DEV
```

**生产环境** (`.env.production`):
```bash
VITE_AES_ENABLED=true
VITE_AES_KEY=${AES_SECRET_KEY}
```

#### 后端配置控制
**主配置** (`application.yml`):
```yaml
svt:
  security:
    aes:
      enabled: true
      key: SVT-DEFAULT-AES-KEY-256BITS-FOR-DEV
      algorithm: AES/CBC/PKCS5Padding
      key-length: 256
      max-data-size: 10485760
```

**开发环境** (`application-dev.yml`):
```yaml
svt:
  security:
    aes:
      enabled: true
      debug: true
      key: SVT-DEFAULT-AES-KEY-256BITS-FOR-DEV
```

### ⚠️ 待完成的关键集成

1. **前端API拦截器集成**
   - 文件: `SVT-Web/src/utils/request.ts`
   - 功能: 在axios请求/响应拦截器中自动处理AES加密解密
   - 状态: 需要集成

2. **后端过滤器/拦截器**
   - 功能: 自动处理请求解密和响应加密
   - 状态: 需要创建

3. **端到端测试**
   - 功能: 验证前后端AES加密通信
   - 状态: 需要实施

## 实施计划

### 阶段1: API拦截器集成 (优先级: P1)
1. 修改前端axios拦截器，集成AES加密解密
2. 创建后端AES过滤器，处理请求/响应加密
3. 实现加密开关的动态控制

### 阶段2: 测试验证 (优先级: P1)  
1. 单元测试：前后端AES工具类
2. 集成测试：端到端加密通信
3. 配置测试：开关控制功能

### 阶段3: 优化完善 (优先级: P2)
1. 性能优化：密钥缓存、批量处理
2. 监控告警：加密失败监控
3. 运维工具：密钥轮换、配置管理

## 配置使用说明

### 开启/关闭AES加密

**前端控制**:
```bash
# 开发环境
# 修改 .env.development
VITE_AES_ENABLED=true   # 启用
VITE_AES_ENABLED=false  # 禁用

# 生产环境  
# 修改 .env.production
VITE_AES_ENABLED=true   # 启用
VITE_AES_ENABLED=false  # 禁用
```

**后端控制**:
```yaml
# 修改 application.yml 或 application-dev.yml
svt:
  security:
    aes:
      enabled: true   # 启用
      enabled: false  # 禁用
```

### 密钥管理

**开发环境**: 使用固定密钥便于调试
**生产环境**: 通过环境变量注入安全密钥

## 安全注意事项

1. **密钥安全**: 生产环境密钥必须通过安全的密钥管理系统获取
2. **密钥轮换**: 建议定期更换生产环境密钥
3. **传输安全**: AES加密是在HTTPS基础上的额外防护
4. **调试模式**: 生产环境必须关闭debug模式

## 总结

AES前后端通信加密方案已基本实现完成，核心组件和配置文件控制功能已就绪。现在您可以通过修改相应的配置文件来控制AES加密的开启和关闭。

**立即可用功能**:
- ✅ 通过配置文件控制AES加密开关
- ✅ 前后端AES加密工具类
- ✅ 可视化配置管理面板
- ✅ 完整的配置文档

**下一步工作**:
- 🔧 集成API拦截器实现自动加密
- 🔧 创建后端过滤器处理加密请求
- ✅ 端到端测试验证

整个方案设计遵循了配置外部化、安全优先、可维护性等原则，与现有系统架构完美集成。 