# SVT ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **é¡¹ç›®åç§°** | SVT (Seventeen) ç®¡ç†ç³»ç»Ÿ |
| **æ–‡æ¡£ç‰ˆæœ¬** | v1.0.0 |
| **æ–‡æ¡£æ—¥æœŸ** | 2025-11-17 |
| **æ¶æ„å¸ˆ** | Winston |
| **æ–‡æ¡£ç±»å‹** | Brownfield Architecture (ç°æœ‰ç³»ç»Ÿæ¶æ„) |

---

## ğŸ“‹ æ–‡æ¡£å¯¼èˆª

1. [é¡¹ç›®æ¦‚è¿°](#ä¸€é¡¹ç›®æ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#äºŒæ¶æ„è®¾è®¡)
3. [åç«¯æ¶æ„](#ä¸‰åç«¯æ¶æ„-svt-server)
4. [å‰ç«¯æ¶æ„](#å››å‰ç«¯æ¶æ„-svt-web)
5. [å®‰å…¨æ¶æ„](#äº”å®‰å…¨æ¶æ„)
6. [æ•°æ®æ¶æ„](#å…­æ•°æ®æ¶æ„)
7. [éƒ¨ç½²æ¶æ„](#ä¸ƒéƒ¨ç½²æ¶æ„)
8. [æ€§èƒ½ä¼˜åŒ–](#å…«æ€§èƒ½ä¼˜åŒ–)
9. [æŠ€æœ¯å€ºåŠ¡](#ä¹æŠ€æœ¯å€ºåŠ¡)
10. [æœªæ¥è§„åˆ’](#åæœªæ¥è§„åˆ’)

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

SVT (Seventeen) æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§ç®¡ç†ç³»ç»Ÿ**ï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼ŒåŸºäºç°ä»£åŒ–æŠ€æœ¯æ ˆæ„å»ºã€‚ç³»ç»Ÿå…·å¤‡å®Œæ•´çš„ç”¨æˆ·ç®¡ç†ã€æƒé™æ§åˆ¶ã€å®¡è®¡æ—¥å¿—ç­‰ä¼ä¸šçº§ç‰¹æ€§ã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- âœ… JWTæ™ºèƒ½ç»­æœŸè®¤è¯
- âœ… AES-256 APIåŠ å¯†
- âœ… æ•°æ®åº“åˆ†å¸ƒå¼é”
- âœ… åˆ†å¸ƒå¼IDç”Ÿæˆ
- âœ… åŠ¨æ€è·¯ç”±æƒé™
- âœ… æ¨¡å—åŒ–å¸ƒå±€ç³»ç»Ÿ
- âœ… æ™ºèƒ½Tabç®¡ç†

### 1.2 æŠ€æœ¯æ ˆæ€»è§ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ |
|------|----------|------|
| **åç«¯æ¡†æ¶** | Spring Boot | 3.5.7 |
| **ç¼–ç¨‹è¯­è¨€** | Java | 21 (LTS) |
| **ORMæ¡†æ¶** | MyBatis-Flex | 1.10.9 |
| **æ•°æ®åº“** | SQL Server | 2019+ |
| **æœ¬åœ°ç¼“å­˜** | Caffeine | 3.1.8 |
| **å‰ç«¯æ¡†æ¶** | React | 19.1.0 |
| **ç¼–ç¨‹è¯­è¨€** | TypeScript | 5.8.3 |
| **æ„å»ºå·¥å…·** | Vite | 6.3.5 |
| **UIç»„ä»¶åº“** | Ant Design | 5.25.4 |
| **çŠ¶æ€ç®¡ç†** | Zustand | 5.0.5 |

### 1.3 ç³»ç»Ÿç‰¹ç‚¹

**æ¶æ„ä¼˜åŠ¿ï¼š**
1. **èŒè´£åˆ†ç¦»æ˜ç¡®**: å‰åç«¯å®Œå…¨åˆ†ç¦»ï¼Œå„å±‚èŒè´£æ¸…æ™°
2. **æ³¨è§£é©±åŠ¨å¼€å‘**: ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ç®€åŒ–å¼€å‘
3. **æœ¬åœ°ç¼“å­˜ä¼˜å…ˆ**: ä½¿ç”¨Caffeineæ›¿ä»£Redisï¼Œç®€åŒ–éƒ¨ç½²
4. **ç±»å‹å®‰å…¨**: 100% TypeScriptç±»å‹è¦†ç›–
5. **æ€§èƒ½ä¼˜åŒ–**: ä»£ç åˆ†å‰²ã€æ‡’åŠ è½½ã€O(1)æƒé™æ£€æŸ¥

**å®‰å…¨ç‰¹æ€§ï¼š**
1. **å¤šå±‚åŠ å¯†**: APIåŠ å¯†(AES-256) + é…ç½®åŠ å¯†(SM4) + å¯†ç å“ˆå¸Œ(Argon2)
2. **ä¹æ­¥è®¤è¯**: JWTä¹æ­¥å®‰å…¨æ£€æŸ¥æµç¨‹
3. **å››å±‚é˜²æŠ¤**: è®¤è¯ â†’ è§’è‰²é€‰æ‹© â†’ çŠ¶æ€éªŒè¯ â†’ æƒé™æ£€æŸ¥
4. **æ™ºèƒ½ç»­æœŸ**: åŸºäºç”¨æˆ·æ´»è·ƒåº¦çš„JWTæ™ºèƒ½ç»­æœŸ

---

## äºŒã€æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ç«¯å±‚                              â”‚
â”‚  React 19.1.0 + TypeScript 5.8.3 + Ant Design 5.25.4       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Layout   â”‚ â”‚  Router   â”‚ â”‚  Stores   â”‚ â”‚  Pages   â”‚   â”‚
â”‚  â”‚  System   â”‚ â”‚  System   â”‚ â”‚  (Zustand)â”‚ â”‚          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                   HTTPS + AES-256åŠ å¯†
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç½‘å…³/ä»£ç†å±‚                             â”‚
â”‚            Nginx (åå‘ä»£ç† + Session Sticky)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       åº”ç”¨æœåŠ¡å±‚                             â”‚
â”‚  Spring Boot 3.5.7 + Java 21 + MyBatis-Flex 1.10.9         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  è¿‡æ»¤å™¨  â”‚ â”‚ AOPåˆ‡é¢  â”‚ â”‚ æ¡†æ¶å±‚   â”‚ â”‚ ä¸šåŠ¡å±‚   â”‚     â”‚
â”‚  â”‚  (Filter)â”‚ â”‚ (Aspect) â”‚ â”‚ (Frame)  â”‚ â”‚ (Module) â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ•°æ®æŒä¹…å±‚                             â”‚
â”‚    SQL Server 2019+ (ä¸»æ•°æ®åº“ + åˆ†å¸ƒå¼é” + åˆ†å¸ƒå¼ID)        â”‚
â”‚    Caffeine Cache (æœ¬åœ°ç¼“å­˜: JWT + ç”¨æˆ·è¯¦æƒ… + IDæ‰¹é‡)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åˆ†å±‚æ¶æ„

#### 2.2.1 å‰ç«¯åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å±•ç¤ºå±‚ (Presentation)            â”‚
â”‚  Pages / Components / Layout            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è·¯ç”±å±‚ (Router)                â”‚
â”‚  ProtectedRoute + DynamicPage           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         çŠ¶æ€å±‚ (State Management)        â”‚
â”‚  Zustand (auth/user) + React Query      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æœåŠ¡å±‚ (API Service)            â”‚
â”‚  axios + åŠ å¯†/è§£å¯† + æ‹¦æˆªå™¨              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.2 åç«¯åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ§åˆ¶å™¨å±‚ (Controller)             â”‚
â”‚  æ¥æ”¶è¯·æ±‚ + å‚æ•°æ ¡éªŒ + è¿”å›å“åº”          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸šåŠ¡å±‚ (Service)                 â”‚
â”‚  ä¸šåŠ¡é€»è¾‘ + äº‹åŠ¡ç®¡ç† + åˆ†å¸ƒå¼é”          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       æ•°æ®è®¿é—®å±‚ (Mapper/DAO)            â”‚
â”‚  MyBatis-Flex + SQLæ‰§è¡Œ + ç»“æœæ˜ å°„      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•°æ®æŒä¹…å±‚ (Database)            â”‚
â”‚  SQL Server + åˆ†å¸ƒå¼é”è¡¨ + IDç”Ÿæˆè¡¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ ¸å¿ƒè®¾è®¡æ¨¡å¼

#### 2.3.1 æ³¨è§£é©±åŠ¨å¼€å‘ (Annotation-Driven)

```java
// ä½¿ç”¨æ³¨è§£ç®€åŒ–å¼€å‘
@PostMapping("/create")
@Audit(description = "åˆ›å»ºç”¨æˆ·", recordParams = true)      // å®¡è®¡æ—¥å¿—
@RequiresPermission("user:create")                       // æƒé™éªŒè¯
@AutoTransaction(type = TransactionType.REQUIRED)        // è‡ªåŠ¨äº‹åŠ¡
public Result<String> createUser(@RequestBody UserDTO dto) {
    return Result.success(userService.createUser(dto));
}
```

**AOPåˆ‡é¢è‡ªåŠ¨å¤„ç†ï¼š**
- å®¡è®¡æ—¥å¿—è®°å½•
- æƒé™éªŒè¯
- äº‹åŠ¡ç®¡ç†
- å‚æ•°è„±æ•

#### 2.3.2 ç›‘å¬å™¨æ¨¡å¼ (Listener Pattern)

```java
@Table(value = "user_info",
       onInsert = FlexInsertListener.class,    // æ’å…¥ç›‘å¬
       onUpdate = FlexUpdateListener.class)    // æ›´æ–°ç›‘å¬
public class UserInfo {
    @DistributedId(prefix = "U")               // è‡ªåŠ¨ç”ŸæˆID
    private String userId;

    @AutoFill(type = FillType.USER_ID, operation = INSERT)  // è‡ªåŠ¨å¡«å……
    private String createBy;
}
```

**ç›‘å¬å™¨è‡ªåŠ¨å¤„ç†ï¼š**
- åˆ†å¸ƒå¼IDç”Ÿæˆ
- å®¡è®¡å­—æ®µè‡ªåŠ¨å¡«å…… (createBy, createTime, updateBy, updateTime)

#### 2.3.3 ç¼“å­˜ç­–ç•¥ (Caching Strategy)

```
è¯·æ±‚æµç¨‹ï¼š
1. æ£€æŸ¥Caffeineæœ¬åœ°ç¼“å­˜
   â”œâ”€ å‘½ä¸­ â†’ ç›´æ¥è¿”å›
   â””â”€ æœªå‘½ä¸­ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ å†™å…¥ç¼“å­˜ â†’ è¿”å›
```

**ç¼“å­˜ä½¿ç”¨åœºæ™¯ï¼š**
- JWT Tokenç¼“å­˜ (æœ€å¤š1000ä¸ªï¼Œ30åˆ†é’Ÿè¿‡æœŸ)
- ç”¨æˆ·è¯¦æƒ…ç¼“å­˜ (æå‡æƒé™éªŒè¯æ€§èƒ½)
- åˆ†å¸ƒå¼IDæ‰¹é‡ç¼“å­˜ (å‡å°‘æ•°æ®åº“è®¿é—®)

---

## ä¸‰ã€åç«¯æ¶æ„ (SVT-Server)

### 3.1 æ•´ä½“ç»“æ„

```
common (é€šç”¨å±‚)
    â”œâ”€â”€ annotation (è‡ªå®šä¹‰æ³¨è§£)
    â”œâ”€â”€ config (é…ç½®ç±»)
    â”œâ”€â”€ filter (è¿‡æ»¤å™¨)
    â””â”€â”€ util (å·¥å…·ç±»)
        â†“
frame (æ¡†æ¶å±‚)
    â”œâ”€â”€ aspect (AOPåˆ‡é¢)
    â”œâ”€â”€ cache (ç¼“å­˜ç®¡ç†)
    â”œâ”€â”€ security (å®‰å…¨æ¡†æ¶)
    â”œâ”€â”€ lock (åˆ†å¸ƒå¼é”)
    â””â”€â”€ dbkey (åˆ†å¸ƒå¼ID)
        â†“
modules (ä¸šåŠ¡å±‚)
    â””â”€â”€ system (ç³»ç»Ÿç®¡ç†æ¨¡å—)
        â”œâ”€â”€ controller (æ§åˆ¶å™¨)
        â”œâ”€â”€ service (ä¸šåŠ¡é€»è¾‘)
        â”œâ”€â”€ entity (å®ä½“ç±»)
        â”œâ”€â”€ dto (æ•°æ®ä¼ è¾“å¯¹è±¡)
        â””â”€â”€ mapper (æ•°æ®è®¿é—®)
```

### 3.2 è¿‡æ»¤å™¨é“¾ (Filter Chain)

**æ‰§è¡Œé¡ºåº (Orderè¶Šå°è¶Šå…ˆæ‰§è¡Œ):**

```
1. AESCryptoFilter (Order=10)
   â”œâ”€ è¯·æ±‚è§£å¯† (æ£€æŸ¥X-Encryptedå¤´)
   â””â”€ å“åº”åŠ å¯†

2. RequestWrapperFilter (Order=50)
   â””â”€ è¯·æ±‚åŒ…è£… (æ”¯æŒå¤šæ¬¡è¯»å–Body)

3. JwtAuthenticationFilter
   â””â”€ JWTä¹æ­¥å®‰å…¨æ£€æŸ¥
```

### 3.3 AOPåˆ‡é¢ (Aspect)

**åˆ‡é¢æ‰§è¡Œé¡ºåº:**

```
1. AutoTransactionAspect (Order=100)
   â””â”€ äº‹åŠ¡ç®¡ç†

2. PermissionAspect
   â””â”€ æƒé™éªŒè¯

3. AuditAspect
   â””â”€ å®¡è®¡æ—¥å¿—è®°å½•

4. ç›®æ ‡æ–¹æ³•æ‰§è¡Œ
```

### 3.4 æ ¸å¿ƒæ¡†æ¶ç»„ä»¶

#### 3.4.1 JWTè®¤è¯æµç¨‹

```
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
1. æå–Token (ä»Authorizationå¤´)
   â†“
2. éªŒè¯Tokenæ ¼å¼å’Œç­¾å
   â†“
3. ä¹æ­¥å®‰å…¨æ£€æŸ¥
   â”œâ”€ éªŒè¯æ˜¯å¦ç³»ç»Ÿé¢å‘çš„åˆæ³•Token
   â”œâ”€ æ£€æŸ¥æ˜¯å¦åœ¨é»‘åå•ä¸­
   â”œâ”€ æ£€æŸ¥JWTç¼“å­˜æ˜¯å¦å­˜åœ¨
   â”œâ”€ æ£€æŸ¥IPåœ°å€å˜åŒ–
   â”œâ”€ æ£€æŸ¥Tokenå˜åŒ– (å•ç‚¹ç™»å½•)
   â”œâ”€ ä¼šè¯æ´»è·ƒåº¦è¿‡æœŸæ£€æŸ¥
   â”œâ”€ æ™ºèƒ½æ´»è·ƒåº¦ç»­æœŸæ£€æŸ¥
   â”œâ”€ ä¼šè¯çŠ¶æ€è®¡ç®—å’Œå“åº”å¤´è®¾ç½®
   â””â”€ æ›´æ–°ç”¨æˆ·æœ€åæ´»åŠ¨æ—¶é—´
   â†“
4. é€šè¿‡éªŒè¯ï¼Œæ”¾è¡Œè¯·æ±‚
```

**å…³é”®æ–‡ä»¶**: `frame/security/filter/JwtAuthenticationFilter.java:245`

#### 3.4.2 åˆ†å¸ƒå¼é”å®ç°

**æ•°æ®åº“åˆ†å¸ƒå¼é”åŸç†:**

```sql
-- åˆ©ç”¨ä¸»é”®å”¯ä¸€æ€§å®ç°äº’æ–¥
CREATE TABLE distributed_lock (
    lock_key VARCHAR(255) PRIMARY KEY,  -- å”¯ä¸€çº¦æŸä¿è¯äº’æ–¥
    lock_value VARCHAR(255),
    expire_time DATETIME
);

-- è·å–é”ï¼šå°è¯•æ’å…¥
INSERT INTO distributed_lock (lock_key, lock_value, expire_time)
VALUES ('user:create:admin', 'uuid-xxx', DATEADD(SECOND, 10, GETDATE()));

-- ä¸»é”®å†²çª â†’ è·å–é”å¤±è´¥
-- æ’å…¥æˆåŠŸ â†’ è·å–é”æˆåŠŸ
```

**æ™ºèƒ½é‡è¯•æœºåˆ¶:**
1. æ£€æµ‹åˆ°é”è¢«å ç”¨
2. ç­‰å¾…æŒ‡å®šé—´éš”åé‡è¯•
3. ç´¯è®¡é‡è¯•æ¬¡æ•°
4. è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åå¼ºåˆ¶é‡Šæ”¾é” (å¯é…ç½®)

**å…³é”®æ–‡ä»¶**: `frame/lock/DatabaseDistributedLockManager.java`

#### 3.4.3 åˆ†å¸ƒå¼IDç”Ÿæˆ

**IDæ ¼å¼:** `å‰ç¼€ + æ—¥æœŸ + åºå· + å­—æ¯æ‰©å±•`

```
ç¤ºä¾‹:
U20250617000001    # ç”¨æˆ·ID
M20250617000002    # èœå•ID
R20250617000003A   # è§’è‰²ID (åºå·è¶…999999ååŠ å­—æ¯)
```

**ç”Ÿæˆæµç¨‹:**
1. ä»ç¼“å­˜è·å–ID (æ‰¹é‡é¢„åˆ†é…100ä¸ª)
2. ç¼“å­˜æœªå‘½ä¸­ â†’ è·å–åˆ†å¸ƒå¼é”
3. æ£€æŸ¥æ—¥æœŸå˜æ›´ â†’ é‡ç½®åºå·
4. ç”Ÿæˆä¸€æ‰¹IDå†™å…¥ç¼“å­˜
5. é‡Šæ”¾é”ï¼Œè¿”å›ç¬¬ä¸€ä¸ªID

**å…³é”®æ–‡ä»¶**: `frame/dbkey/DistributedIdGenerator.java`

### 3.5 ç¼“å­˜æ¶æ„

**Caffeineç¼“å­˜é…ç½®:**

```java
// JWT Tokenç¼“å­˜
Caffeine.newBuilder()
    .maximumSize(1000)              // æœ€å¤š1000ä¸ªToken
    .expireAfterWrite(30, MINUTES)  // 30åˆ†é’Ÿè¿‡æœŸ
    .recordStats()                  // è®°å½•ç»Ÿè®¡
    .build();
```

**ç¼“å­˜å·¥å…·ç±»å®¶æ—:**

| ç¼“å­˜å·¥å…· | ç”¨é€” | å®¹é‡ | è¿‡æœŸæ—¶é—´ |
|---------|------|------|----------|
| JwtCacheUtils | JWT Token | 1000 | 30åˆ†é’Ÿ |
| UserDetailCacheUtils | ç”¨æˆ·è¯¦æƒ… | 1000 | 30åˆ†é’Ÿ |
| DbKeyCacheUtils | åˆ†å¸ƒå¼IDæ‰¹é‡ | æ— é™ | ä¸è¿‡æœŸ |
| OrgInfoCacheUtils | ç»„ç»‡æœºæ„ | 500 | 1å°æ—¶ |

**ç¼“å­˜ç­–ç•¥:**
- âœ… æœ¬åœ°ç¼“å­˜ä¼˜å…ˆ (ç®€åŒ–éƒ¨ç½²)
- âœ… Session Sticky (ç¡®ä¿ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°åŒä¸€å®ä¾‹)
- âœ… æœåŠ¡é‡å¯åç”¨æˆ·éœ€é‡æ–°ç™»å½• (å®‰å…¨è®¾è®¡)

---

## å››ã€å‰ç«¯æ¶æ„ (SVT-Web)

### 4.1 æ•´ä½“ç»“æ„

```
utils (å·¥å…·å±‚)
    â”œâ”€â”€ request.ts (HTTPå®¢æˆ·ç«¯)
    â”œâ”€â”€ tokenManager.ts (Tokenç®¡ç†)
    â”œâ”€â”€ sessionManager.ts (ä¼šè¯ç®¡ç†)
    â””â”€â”€ crypto.ts (åŠ å¯†å·¥å…·)
        â†“
stores (çŠ¶æ€ç®¡ç†)
    â”œâ”€â”€ authStore.ts (è®¤è¯çŠ¶æ€)
    â”œâ”€â”€ userStore.ts (ç”¨æˆ·çŠ¶æ€)
    â””â”€â”€ useAuth.ts (ç»„åˆHook)
        â†“
hooks (è‡ªå®šä¹‰Hooks)
    â”œâ”€â”€ useUserStatus.ts
    â””â”€â”€ useMobile.ts
        â†“
api (APIæœåŠ¡å±‚)
    â””â”€â”€ system/ (ç³»ç»Ÿç®¡ç†API)
        â†“
components (ç»„ä»¶å±‚)
    â”œâ”€â”€ Layout/ (å¸ƒå±€ç³»ç»Ÿ)
    â””â”€â”€ DynamicPage/ (åŠ¨æ€é¡µé¢)
        â†“
pages (é¡µé¢å±‚)
    â”œâ”€â”€ Auth/ (è®¤è¯é¡µé¢)
    â”œâ”€â”€ System/ (ç³»ç»Ÿç®¡ç†)
    â””â”€â”€ Business/ (ä¸šåŠ¡æ¨¡å—)
        â†“
router (è·¯ç”±å±‚)
    â”œâ”€â”€ index.tsx (è·¯ç”±é…ç½®)
    â””â”€â”€ ProtectedRoute.tsx (è·¯ç”±ä¿æŠ¤)
```

### 4.2 çŠ¶æ€ç®¡ç†æ¶æ„

#### 4.2.1 èŒè´£åˆ†ç¦»çš„Storeè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          authStore.ts                    â”‚
â”‚  (çº¯è®¤è¯é€»è¾‘)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ token                           â”‚  â”‚
â”‚  â”‚ â€¢ isAuthenticated                 â”‚  â”‚
â”‚  â”‚ â€¢ loading                         â”‚  â”‚
â”‚  â”‚ â€¢ login()                         â”‚  â”‚
â”‚  â”‚ â€¢ logout()                        â”‚  â”‚
â”‚  â”‚ â€¢ clearAuthState()                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          userStore.ts                    â”‚
â”‚  (ç”¨æˆ·ä¿¡æ¯ + ä¼šè¯ç®¡ç†)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ user                            â”‚  â”‚
â”‚  â”‚ â€¢ session                         â”‚  â”‚
â”‚  â”‚   â”œâ”€ hasSelectedOrgRole           â”‚  â”‚
â”‚  â”‚   â”œâ”€ orgRoleData                  â”‚  â”‚
â”‚  â”‚   â””â”€ loginStep                    â”‚  â”‚
â”‚  â”‚ â€¢ setUser()                       â”‚  â”‚
â”‚  â”‚ â€¢ refreshUserInfo()               â”‚  â”‚
â”‚  â”‚ â€¢ completeOrgRoleSelection()      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          useAuth.ts                      â”‚
â”‚  (ç»„åˆHook - åè°ƒå„Store)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ const auth = useAuthStore()       â”‚  â”‚
â”‚  â”‚ const user = useUserStore()       â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚ return {                          â”‚  â”‚
â”‚  â”‚   auth, user,                     â”‚  â”‚
â”‚  â”‚   login, logout,                  â”‚  â”‚
â”‚  â”‚   isAuthenticated,                â”‚  â”‚
â”‚  â”‚   currentUser                     â”‚  â”‚
â”‚  â”‚ }                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡ä¼˜åŠ¿:**
- âœ… èŒè´£å•ä¸€ï¼šè®¤è¯ã€ç”¨æˆ·ã€ä¼šè¯å„å¸å…¶èŒ
- âœ… é˜²é‡å¤æ“ä½œï¼šloadingæ ‡å¿—é˜²æ­¢å¹¶å‘è°ƒç”¨
- âœ… åŸç”ŸlocalStorageï¼šç®€åŒ–å­˜å‚¨ï¼Œç§»é™¤åŠ å¯†å¤æ‚æ€§
- âœ… è‡ªåŠ¨çŠ¶æ€æ¢å¤ï¼šZustand persistè‡ªåŠ¨ä»localStorageæ¢å¤

#### 4.2.2 ç™»å½•æµç¨‹

```
ç”¨æˆ·æäº¤ç™»å½•è¡¨å•
    â†“
1. è°ƒç”¨ useAuth().login(credentials)
   â”œâ”€ è®¾ç½® loginStep = 'initial'
   â””â”€ è°ƒç”¨ authStore.login()
       â”œâ”€ APIè¯·æ±‚: POST /api/auth/login
       â”œâ”€ ä¿å­˜ token åˆ° authStore
       â”œâ”€ å¯åŠ¨ tokenManager
       â””â”€ å¯åŠ¨ sessionManager
   â†“
2. è®¾ç½® loginStep = 'authenticated'
   â”œâ”€ æ˜¾ç¤ºæœºæ„è§’è‰²é€‰æ‹©é¡µé¢
   â””â”€ ç”¨æˆ·é€‰æ‹©æœºæ„å’Œè§’è‰²
   â†“
3. è°ƒç”¨ user.completeOrgRoleSelection(userDetails)
   â”œâ”€ ä¿å­˜ orgRoleData åˆ° userStore
   â”œâ”€ è®¾ç½® loginStep = 'completed'
   â””â”€ è®¾ç½® hasSelectedOrgRole = true
   â†“
4. è·¯ç”±å®ˆå«æ£€æŸ¥é€šè¿‡
   â””â”€ é‡å®šå‘åˆ°é¦–é¡µ /home
```

### 4.3 æ¨¡å—åŒ–Layoutç³»ç»Ÿ

#### 4.3.1 ä¸‰å±‚Layoutæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       BasicLayout.tsx (å®¹å™¨å±‚)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç”¨æˆ·çŠ¶æ€éªŒè¯                        â”‚  â”‚
â”‚  â”‚ Loadingå±•ç¤º                        â”‚  â”‚
â”‚  â”‚ 43è¡Œä»£ç  (ä¼˜åŒ–60%)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    LayoutProvider.tsx (çŠ¶æ€å±‚)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ ä¾§è¾¹æ çŠ¶æ€ (collapsed)           â”‚  â”‚
â”‚  â”‚ â€¢ Tabåˆ—è¡¨å’Œæ¿€æ´»çŠ¶æ€                â”‚  â”‚
â”‚  â”‚ â€¢ è·¯å¾„æ˜ å°„ (åŸºäºç”¨æˆ·èœå•)          â”‚  â”‚
â”‚  â”‚ â€¢ é¡µé¢åˆ·æ–°æ§åˆ¶                     â”‚  â”‚
â”‚  â”‚ â€¢ Tabæ“ä½œæ–¹æ³• (9ä¸ª)                â”‚  â”‚
â”‚  â”‚ â€¢ é˜²é‡å¤æ“ä½œæœºåˆ¶                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LayoutStructure.tsx (å±•ç¤ºå±‚)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Sidebar (ä¾§è¾¹æ )                   â”‚  â”‚
â”‚  â”‚ Header (é¡¶éƒ¨å¯¼èˆª)                  â”‚  â”‚
â”‚  â”‚ TabSystem (æ ‡ç­¾é¡µ)                 â”‚  â”‚
â”‚  â”‚ Content (é¡µé¢å†…å®¹)                 â”‚  â”‚
â”‚  â”‚ Footer (åº•éƒ¨)                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŒ–æˆæœ:**
- BasicLayout: 107è¡Œ â†’ 43è¡Œ (-60%)
- Hookæ•°é‡: 4ä¸ª â†’ 1ä¸ª (-75%)
- èŒè´£æ›´æ¸…æ™°ï¼Œå¯ç»´æŠ¤æ€§æ›´å¼º

#### 4.3.2 æ™ºèƒ½Tabç³»ç»Ÿ

**TabçŠ¶æ€ç®¡ç†:**

```typescript
interface TabState {
  activeTabKey: string;          // å½“å‰æ¿€æ´»Tab
  tabList: TabItem[];            // Tabåˆ—è¡¨

  // Tabæ“ä½œ (9ä¸ªæ–¹æ³•)
  addTab: (path: string, forceRefresh?: boolean) => void;
  switchTab: (key: string) => void;
  removeTab: (key: string) => void;
  refreshTab: (key: string) => void;
  closeLeftTabs: (currentKey: string) => void;
  closeRightTabs: (currentKey: string) => void;
  closeOtherTabs: (currentKey: string) => void;
}
```

**é˜²é‡å¤æ“ä½œæœºåˆ¶:**

```typescript
// ä½¿ç”¨refæ ‡å¿—é˜²æ­¢å¹¶å‘æ“ä½œ
const isOperatingRef = useRef(false);

const switchTab = useCallback((targetKey: string) => {
  if (isOperatingRef.current) return;  // é˜²æ­¢é‡å¤ç‚¹å‡»

  isOperatingRef.current = true;
  // ... æ‰§è¡Œåˆ‡æ¢é€»è¾‘

  setTimeout(() => {
    isOperatingRef.current = false;
  }, 100);
}, []);
```

**æŒä¹…åŒ–ç­–ç•¥:**
- localStorageå­˜å‚¨Tabåˆ—è¡¨å’Œæ¿€æ´»çŠ¶æ€
- é¡µé¢åˆ·æ–°åè‡ªåŠ¨æ¢å¤TabçŠ¶æ€
- é¦–é¡µTabå§‹ç»ˆå­˜åœ¨ä¸”ä¸å¯å…³é—­

### 4.4 åŠ¨æ€è·¯ç”±ä¸æƒé™ç³»ç»Ÿ

#### 4.4.1 å››å±‚å®‰å…¨é˜²æŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ProtectedRoute.tsx (è·¯ç”±ä¿æŠ¤ç»„ä»¶)       â”‚
â”‚                                         â”‚
â”‚  1ï¸âƒ£ åŸºç¡€è®¤è¯æ£€æŸ¥ (å¿«é€Ÿå“åº”)              â”‚
â”‚     if (!isAuthenticated) â†’ /login    â”‚
â”‚                                         â”‚
â”‚  2ï¸âƒ£ æœºæ„è§’è‰²æ£€æŸ¥                         â”‚
â”‚     if (!hasSelectedOrgRole) â†’ /login â”‚
â”‚                                         â”‚
â”‚  3ï¸âƒ£ ç”¨æˆ·çŠ¶æ€éªŒè¯ä¸­                       â”‚
â”‚     if (loading) â†’ PageLoading        â”‚
â”‚                                         â”‚
â”‚  4ï¸âƒ£ ç”¨æˆ·çŠ¶æ€æ— æ•ˆ                         â”‚
â”‚     if (!userStatus.isValid) â†’ /login â”‚
â”‚                                         â”‚
â”‚  âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ â†’ æ¸²æŸ“é¡µé¢               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.4.2 åŠ¨æ€é¡µé¢åŠ è½½æµç¨‹

```
ç”¨æˆ·è®¿é—® /system/menu
    â†“
DynamicPageç»„ä»¶
    â†“
1. æ„å»ºæƒé™ç´¢å¼• (O(1)æŸ¥è¯¢ä¼˜åŒ–)
   permissionPaths = useMemo(() => {
     const paths = new Set<string>();
     // é€’å½’éå†menuTreesï¼Œæ”¶é›†æ‰€æœ‰è·¯å¾„
     return paths;
   }, [currentUser?.menuTrees]);
   â†“
2. O(1)æƒé™æ£€æŸ¥
   hasPermission = permissionPaths.has('/system/menu')
   if (!hasPermission) return <NotFoundPage />
   â†“
3. æ„å»ºç»„ä»¶è·¯å¾„
   /system/menu â†’ ../../pages/System/Menu/index.tsx
   â†“
4. åŠ¨æ€åŠ è½½ç»„ä»¶
   const PageComponent = lazy(() => import(componentPath))
   â†“
5. æ¸²æŸ“ç»„ä»¶ (å¸¦ErrorBoundary)
   <Suspense fallback={<PageLoading />}>
     <ErrorBoundary>
       <PageComponent />
     </ErrorBoundary>
   </Suspense>
```

**æ€§èƒ½ä¼˜åŒ–:**

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|--------|--------|--------|------|
| æƒé™æ£€æŸ¥å¤æ‚åº¦ | O(n) é€’å½’éå† | O(1) SetæŸ¥è¯¢ | 100x+ |
| ç»„ä»¶åŠ è½½æ–¹å¼ | é™æ€å¯¼å…¥ | æ‡’åŠ è½½ | å‡å°‘é¦–å±ä½“ç§¯ |
| é‡å¤æ¸²æŸ“ | æ¯æ¬¡éƒ½è®¡ç®— | useMemoç¼“å­˜ | é¿å…é‡å¤è®¡ç®— |

---

## äº”ã€å®‰å…¨æ¶æ„

### 5.1 å¤šå±‚å®‰å…¨é˜²æŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 å®¢æˆ·ç«¯ (SVT-Web)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                 HTTPS + AES-256åŠ å¯†
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¿‡æ»¤å™¨é“¾ (Filter Chain)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. AESCryptoFilter                           â”‚  â”‚
â”‚  â”‚    â”œâ”€ æ£€æŸ¥ X-Encrypted: true                â”‚  â”‚
â”‚  â”‚    â”œâ”€ AES-256è§£å¯†è¯·æ±‚ä½“                      â”‚  â”‚
â”‚  â”‚    â””â”€ AES-256åŠ å¯†å“åº”ä½“                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2. JwtAuthenticationFilter                   â”‚  â”‚
â”‚  â”‚    â””â”€ ä¹æ­¥å®‰å…¨æ£€æŸ¥                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                AOPåˆ‡é¢ (Aspect)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PermissionAspect                             â”‚  â”‚
â”‚  â”‚ â””â”€ @RequiresPermissionæƒé™éªŒè¯               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ä¸šåŠ¡é€»è¾‘å±‚ (Service)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 åŠ å¯†ä½“ç³»

#### 5.2.1 ä¸‰å±‚åŠ å¯†ç­–ç•¥

| åŠ å¯†ç±»å‹ | ç®—æ³• | ç”¨é€” | å¯†é’¥ç®¡ç† |
|---------|------|------|----------|
| **APIåŠ å¯†** | AES-256-CBC | è¯·æ±‚/å“åº”ä½“åŠ å¯† | ç¯å¢ƒå˜é‡ `SVT_AES_KEY` |
| **é…ç½®åŠ å¯†** | SM4 | é…ç½®æ–‡ä»¶æ•æ„Ÿä¿¡æ¯ | ç¯å¢ƒå˜é‡ `SM4_ENCRYPTION_KEY` |
| **å¯†ç å“ˆå¸Œ** | Argon2 | ç”¨æˆ·å¯†ç å­˜å‚¨ | å†…ç½®å‚æ•°é…ç½® |

#### 5.2.2 AES-256åŠ å¯†æµç¨‹

**è¯·æ±‚åŠ å¯† (å‰ç«¯):**

```typescript
// 1. ç”ŸæˆéšæœºIV
const iv = CryptoJS.lib.WordArray.random(16);

// 2. AES-256-CBCåŠ å¯†
const encrypted = CryptoJS.AES.encrypt(
  JSON.stringify(data),
  CryptoJS.enc.Utf8.parse(aesKey),
  {
    iv: iv,
    mode: CryptoJS.mode.CBC,
    padding: CryptoJS.pad.Pkcs7
  }
);

// 3. æ„é€ åŠ å¯†è¯·æ±‚
const encryptedRequest = {
  encrypted: true,
  data: encrypted.toString(),  // Base64ç¼–ç 
  iv: iv.toString(CryptoJS.enc.Hex)
};

// 4. å‘é€è¯·æ±‚
fetch('/api/xxx', {
  method: 'POST',
  headers: { 'X-Encrypted': 'true' },
  body: JSON.stringify(encryptedRequest)
});
```

**è¯·æ±‚è§£å¯† (åç«¯):**

```java
// 1. æ£€æŸ¥è¯·æ±‚å¤´
if ("true".equals(request.getHeader("X-Encrypted"))) {
    // 2. è§£æåŠ å¯†æ•°æ®
    Map<String, Object> encryptedData = objectMapper.readValue(body, Map.class);
    String encryptedText = (String) encryptedData.get("data");
    String ivHex = (String) encryptedData.get("iv");

    // 3. AES-256è§£å¯†
    byte[] iv = Hex.decode(ivHex);
    byte[] encrypted = Base64.getDecoder().decode(encryptedText);

    Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
    cipher.init(Cipher.DECRYPT_MODE, secretKeySpec, new IvParameterSpec(iv));
    byte[] decrypted = cipher.doFinal(encrypted);

    // 4. è¿”å›æ˜æ–‡JSON
    return new String(decrypted, StandardCharsets.UTF_8);
}
```

#### 5.2.3 Argon2å¯†ç å“ˆå¸Œ

**é…ç½®å‚æ•°:**

```java
@Configuration
public class SVTArgon2PasswordEncoder extends Argon2PasswordEncoder {
    public SVTArgon2PasswordEncoder() {
        super(
            16,     // saltLength: ç›é•¿åº¦16å­—èŠ‚
            32,     // hashLength: å“ˆå¸Œé•¿åº¦32å­—èŠ‚
            1,      // parallelism: å¹¶è¡Œåº¦1
            65536,  // memory: å†…å­˜å¼€é”€64MB
            3       // iterations: è¿­ä»£æ¬¡æ•°3
        );
    }
}
```

**å“ˆå¸Œç¤ºä¾‹:**

```
åŸå§‹å¯†ç : admin123

Argon2å“ˆå¸Œ:
$argon2id$v=19$m=65536,t=3,p=1$
abc123def456xyz789$
1a2b3c4d5e6f7g8h9i0j...
```

**å®‰å…¨ä¼˜åŠ¿:**
- âœ… æŠ—GPU/ASICæ”»å‡» (å†…å­˜å¯†é›†å‹)
- âœ… æŠ—å¹¶è¡Œæ”»å‡» (å¯é…ç½®å¹¶è¡Œåº¦)
- âœ… æŠ—å½©è™¹è¡¨æ”»å‡» (éšæœºç›)

### 5.3 JWTæ™ºèƒ½ç»­æœŸæœºåˆ¶

**æ´»è·ƒåº¦ç»­æœŸå‚æ•°:**

```yaml
svt:
  jwt:
    activity-cycle-seconds: 600        # æ´»è·ƒåº¦å‘¨æœŸ10åˆ†é’Ÿ
    activity-renewal-threshold: 20     # ç»­æœŸé˜ˆå€¼20% (æœ€å2åˆ†é’Ÿ)
```

**ç»­æœŸé€»è¾‘:**

```
ç”¨æˆ·æœ€åæ´»åŠ¨æ—¶é—´: 10:00:00
æ´»è·ƒåº¦å‘¨æœŸ: 10åˆ†é’Ÿ
ç»­æœŸçª—å£: æœ€å20% (æœ€å2åˆ†é’Ÿ)

æ—¶é—´çº¿:
10:00:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 10:08:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 10:10:00
         æ­£å¸¸æœŸ                ç»­æœŸçª—å£          è¿‡æœŸ

åœ¨ç»­æœŸçª—å£å†…çš„ä»»ä½•è¯·æ±‚ â†’ è‡ªåŠ¨ç»­æœŸ
    æ›´æ–° lastActivityTime
    æ›´æ–° activityCycleStartTime
    é‡æ–°è®¡ç®—è¿‡æœŸæ—¶é—´
```

**ä¼šè¯çŠ¶æ€å“åº”å¤´:**

```
X-Session-Status: NORMAL / EXPIRED
X-Session-Remaining: 120000 (æ¯«ç§’)
X-Session-Warning: JWT_TOKEN_EXPIRED / ACTIVITY_EXPIRED
```

---

## å…­ã€æ•°æ®æ¶æ„

### 6.1 æ•°æ®åº“è®¾è®¡

#### 6.1.1 æ ¸å¿ƒè¡¨ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç³»ç»Ÿç®¡ç†è¡¨                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_info        ç”¨æˆ·è¡¨              â”‚
â”‚ role_info        è§’è‰²è¡¨              â”‚
â”‚ menu_info        èœå•è¡¨              â”‚
â”‚ org_info         ç»„ç»‡æœºæ„è¡¨          â”‚
â”‚ user_role        ç”¨æˆ·è§’è‰²å…³è”è¡¨      â”‚
â”‚ role_menu        è§’è‰²èœå•å…³è”è¡¨      â”‚
â”‚ user_org         ç”¨æˆ·ç»„ç»‡å…³è”è¡¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å®¡è®¡æ—¥å¿—è¡¨                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ audit_log        å®¡è®¡æ—¥å¿—è¡¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ¡†æ¶è¡¨                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ db_key           åˆ†å¸ƒå¼IDè¡¨          â”‚
â”‚ distributed_lock åˆ†å¸ƒå¼é”è¡¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.1.2 æ ‡å‡†å­—æ®µè§„èŒƒ

**æ‰€æœ‰è¡¨å¿…é¡»åŒ…å«çš„å­—æ®µ:**

```sql
-- å®¡è®¡å­—æ®µ (å¿…é¡»)
create_by VARCHAR(32) COMMENT 'åˆ›å»ºè€…',
create_time DATETIME DEFAULT GETDATE() COMMENT 'åˆ›å»ºæ—¶é—´',
update_by VARCHAR(32) COMMENT 'æ›´æ–°è€…',
update_time DATETIME COMMENT 'æ›´æ–°æ—¶é—´',

-- é€»è¾‘åˆ é™¤ (å¿…é¡»)
del_flag CHAR(1) DEFAULT '0' COMMENT 'åˆ é™¤æ ‡å¿— (0æ­£å¸¸ 1åˆ é™¤)'
```

**å‘½åè§„èŒƒ:**
- è¡¨åï¼šå°å†™+ä¸‹åˆ’çº¿ (user_info)
- å­—æ®µåï¼šå°å†™+ä¸‹åˆ’çº¿ (user_id)
- ä¸»é”®çº¦æŸï¼špk_è¡¨å (pk_user_info)
- ç´¢å¼•åï¼šidx_è¡¨å_å­—æ®µå (idx_user_info_login_id)

### 6.2 åˆ†å¸ƒå¼IDè®¾è®¡

**IDæ ¼å¼:** `å‰ç¼€ + æ—¥æœŸ + åºå· + å­—æ¯æ‰©å±•`

```
U20250617000001    # ç”¨æˆ·ID
M20250617000002    # èœå•ID
R20250617000003A   # è§’è‰²ID (åºå·è¶…999999ååŠ å­—æ¯)
```

**db_keyè¡¨ç»“æ„:**

```sql
CREATE TABLE db_key (
    table_name VARCHAR(50) PRIMARY KEY,      -- è¡¨å
    field_name VARCHAR(50) NOT NULL,         -- å­—æ®µå
    prefix VARCHAR(10),                      -- å‰ç¼€ (U, M, R)
    current_id BIGINT DEFAULT 1,             -- å½“å‰åºå·
    current_letter_position INT DEFAULT 0,   -- å½“å‰å­—æ¯ä½ç½®
    record_date DATETIME,                    -- è®°å½•æ—¥æœŸ
    step INT DEFAULT 100,                    -- æ­¥é•¿ (æ‰¹é‡ç”Ÿæˆ)
    create_time DATETIME DEFAULT GETDATE(),
    update_time DATETIME
);
```

**æ—¥æœŸé‡ç½®æœºåˆ¶:**
- æ¯å¤©å‡Œæ™¨è‡ªåŠ¨é‡ç½®åºå·ä¸º1
- ç¡®ä¿IDæŒ‰æ—¥æœŸé€’å¢

### 6.3 åˆ†å¸ƒå¼é”è®¾è®¡

**distributed_lockè¡¨ç»“æ„:**

```sql
CREATE TABLE distributed_lock (
    lock_key VARCHAR(255) PRIMARY KEY,       -- é”é”® (å”¯ä¸€çº¦æŸä¿è¯äº’æ–¥)
    lock_value VARCHAR(255),                 -- é”å€¼ (UUID)
    holder_info VARCHAR(500),                -- æŒæœ‰è€…ä¿¡æ¯
    created_time DATETIME,                   -- åˆ›å»ºæ—¶é—´
    expire_time DATETIME,                    -- è¿‡æœŸæ—¶é—´
    retry_count INT DEFAULT 0                -- é‡è¯•æ¬¡æ•°
);
```

**è·å–é”æµç¨‹:**
1. å°è¯•æ’å…¥è®°å½• (ä¾èµ–ä¸»é”®å”¯ä¸€æ€§)
2. æ’å…¥æˆåŠŸ â†’ è·å–é”æˆåŠŸ
3. ä¸»é”®å†²çª â†’ è·å–é”å¤±è´¥ â†’ é‡è¯•

**é‡Šæ”¾é”æµç¨‹:**
1. éªŒè¯ lock_value åŒ¹é… (é˜²æ­¢è¯¯é‡Šæ”¾)
2. åˆ é™¤é”è®°å½•

**å®šæ—¶æ¸…ç†ä»»åŠ¡:**
- æ¯60ç§’æ¸…ç†è¿‡æœŸé”
- æ¸…ç†è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°çš„é”

---

## ä¸ƒã€éƒ¨ç½²æ¶æ„

### 7.1 å®¹å™¨åŒ–éƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'

services:
  # åç«¯æœåŠ¡
  svt-server:
    image: svt-server:1.0.0
    container_name: svt-server
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - SM4_ENCRYPTION_KEY=${SM4_KEY}
      - SVT_AES_KEY=${AES_KEY}
    depends_on:
      - sqlserver
    networks:
      - svt-network

  # å‰ç«¯æœåŠ¡
  svt-web:
    image: svt-web:1.0.0
    container_name: svt-web
    ports:
      - "80:80"
    networks:
      - svt-network

  # æ•°æ®åº“
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2019-latest
    container_name: svt-sqlserver
    ports:
      - "1433:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${DB_PASSWORD}
    volumes:
      - sqlserver-data:/var/opt/mssql
    networks:
      - svt-network

volumes:
  sqlserver-data:

networks:
  svt-network:
    driver: bridge
```

### 7.2 Nginxé…ç½®

```nginx
upstream svt-backend {
    ip_hash;  # Session Sticky: åŸºäºIPçš„ä¼šè¯ç²˜æ€§
    server svt-server-1:8080;
    server svt-server-2:8080;
}

server {
    listen 80;
    server_name svt.example.com;

    # å‰ç«¯é™æ€èµ„æº
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://svt-backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
}
```

**å…³é”®é…ç½®è¯´æ˜:**
- âœ… **ip_hash**: ç¡®ä¿åŒä¸€IPçš„è¯·æ±‚è·¯ç”±åˆ°åŒä¸€åç«¯å®ä¾‹
- âœ… **try_files**: æ”¯æŒå‰ç«¯è·¯ç”±Historyæ¨¡å¼
- âœ… **proxy_timeout**: é˜²æ­¢é•¿æ—¶é—´è¯·æ±‚è¶…æ—¶

### 7.3 å¤šç¯å¢ƒé…ç½®

```
ç¯å¢ƒåˆ—è¡¨:
â”œâ”€â”€ dev (å¼€å‘ç¯å¢ƒ)
â”‚   â”œâ”€â”€ application-dev.yml
â”‚   â”œâ”€â”€ .env.development
â”‚   â””â”€â”€ æœ¬åœ°æ•°æ®åº“
â”‚
â”œâ”€â”€ uat (UATç¯å¢ƒ)
â”‚   â”œâ”€â”€ application-uat.yml
â”‚   â”œâ”€â”€ .env.uat
â”‚   â””â”€â”€ UATæ•°æ®åº“
â”‚
â””â”€â”€ prod (ç”Ÿäº§ç¯å¢ƒ)
    â”œâ”€â”€ application-prod.yml
    â”œâ”€â”€ .env.production
    â””â”€â”€ ç”Ÿäº§æ•°æ®åº“
```

**ç¯å¢ƒå˜é‡ç®¡ç†:**

```bash
# åç«¯ç¯å¢ƒå˜é‡
export SPRING_PROFILES_ACTIVE=prod
export SM4_ENCRYPTION_KEY=xxx
export SVT_AES_KEY=xxx
export DB_PASSWORD=xxx

# å‰ç«¯ç¯å¢ƒå˜é‡
export VITE_API_BASE_URL=https://api.svt.example.com
export VITE_AES_KEY=xxx
```

---

## å…«ã€æ€§èƒ½ä¼˜åŒ–

### 8.1 åç«¯æ€§èƒ½ä¼˜åŒ–

#### 8.1.1 æ•°æ®åº“ä¼˜åŒ–

**ç´¢å¼•ä¼˜åŒ–:**

```sql
-- æŸ¥è¯¢é¢‘ç¹å­—æ®µå»ºç«‹ç´¢å¼•
CREATE INDEX idx_user_info_login_id ON user_info(login_id);
CREATE INDEX idx_user_info_status ON user_info(status);
CREATE INDEX idx_audit_log_create_time ON audit_log(create_time);

-- å¤åˆç´¢å¼• (æœ€å·¦å‰ç¼€åŸåˆ™)
CREATE INDEX idx_user_info_status_create_time
ON user_info(status, create_time);
```

**æ‰¹é‡æ“ä½œ:**

```java
// âœ… æ‰¹é‡æ’å…¥
userInfoMapper.insertBatch(userList);

// âŒ å¾ªç¯æ’å…¥ (Næ¬¡æ•°æ®åº“è®¿é—®)
for (UserInfo user : userList) {
    userInfoMapper.insert(user);
}
```

**åˆ†é¡µæŸ¥è¯¢:**

```java
// ä½¿ç”¨MyBatis-Flexåˆ†é¡µ
Page<UserInfo> page = userInfoMapper.paginate(
    pageNumber,
    pageSize,
    QueryWrapper.create().from(USER_INFO)
);
```

#### 8.1.2 ç¼“å­˜ä¼˜åŒ–

**ç¼“å­˜ä½¿ç”¨ç­–ç•¥:**

```java
// è¯»æ“ä½œï¼šå…ˆæŸ¥ç¼“å­˜
UserDetailCache cached = UserDetailCacheUtils.get(userId);
if (cached != null) {
    return cached;  // ç¼“å­˜å‘½ä¸­
}

// ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
UserInfo user = userInfoMapper.selectById(userId);
UserDetailCache cache = convertToCache(user);

// å†™å…¥ç¼“å­˜
UserDetailCacheUtils.put(userId, cache);
return cache;
```

**ç¼“å­˜å¤±æ•ˆç­–ç•¥:**

```java
// æ›´æ–°/åˆ é™¤æ—¶æ¸…é™¤ç¼“å­˜
@CacheEvict(value = "user", key = "#userId")
public void updateUser(String userId, UserInfo userInfo) {
    userInfoMapper.updateById(userInfo);
}
```

### 8.2 å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### 8.2.1 ä»£ç åˆ†å‰²

**è·¯ç”±çº§æ‡’åŠ è½½:**

```typescript
// æ‡’åŠ è½½é¡µé¢ç»„ä»¶
const LoginPage = lazy(() => import('@/pages/Auth/LoginPage'));
const HomePage = lazy(() => import('@/pages/Home/HomePage'));

// åŠ¨æ€é¡µé¢æ¨¡å—æ‡’åŠ è½½
const pageModules = import.meta.glob('../../pages/**/index.tsx');
```

**Viteæ‰‹åŠ¨åˆ†åŒ…:**

```typescript
// vite.config.ts
build: {
  rollupOptions: {
    output: {
      manualChunks: {
        vendor: ['react', 'react-dom'],      // 520KB â†’ 180KB
        antd: ['antd', '@ant-design/icons'], // â†’ 200KB
        router: ['react-router-dom'],        // â†’ 40KB
        utils: ['axios', 'dayjs', 'crypto-js'] // â†’ 100KB
      }
    }
  }
}
```

**ä¼˜åŒ–æ•ˆæœ:**

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| Bundleå¤§å° | 850KB | 520KB | -39% |
| é¦–å±åŠ è½½æ—¶é—´ | 2.5s | 1.2s | -52% |
| FCP | 1.5s | 0.8s | -47% |

#### 8.2.2 Reactä¼˜åŒ–

**useMemoç¼“å­˜è®¡ç®—ç»“æœ:**

```typescript
// æƒé™ç´¢å¼•æ„å»º (O(1)æŸ¥è¯¢)
const permissionPaths = useMemo(() => {
  return buildPermissionIndex(currentUser?.menuTrees || []);
}, [currentUser?.menuTrees]);
```

**useCallbackç¼“å­˜å‡½æ•°å¼•ç”¨:**

```typescript
// äº‹ä»¶å¤„ç†å‡½æ•°
const handleMenuClick = useCallback((key: string) => {
  addTab(key, false);
}, [addTab]);
```

**ç»„ä»¶çº§ä¼˜åŒ–:**

```typescript
// React.memoé˜²æ­¢ä¸å¿…è¦çš„é‡æ¸²æŸ“
const UserCard = React.memo<UserCardProps>(({ user, onClick }) => {
  return <div onClick={() => onClick(user)}>{user.name}</div>;
});
```

#### 8.2.3 ç½‘ç»œä¼˜åŒ–

**è¯·æ±‚ä¼˜åŒ–:**

```typescript
// GETè¯·æ±‚é˜²ç¼“å­˜
if (config.method === 'get') {
  config.params = { ...config.params, _t: Date.now() };
}

// è¯·æ±‚è¶…æ—¶è®¾ç½®
const request = axios.create({
  timeout: 15000  // 15ç§’è¶…æ—¶
});
```

**å¹¶è¡Œè¯·æ±‚:**

```typescript
// å¹¶è¡Œè¯·æ±‚å¤šä¸ªAPI
const [users, roles, menus] = await Promise.all([
  userApi.getUserList(),
  roleApi.getRoleList(),
  menuApi.getMenuTree()
]);
```

---

## ä¹ã€æŠ€æœ¯å€ºåŠ¡

### 9.1 å·²çŸ¥é—®é¢˜

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | å½±å“èŒƒå›´ | ä¼˜å…ˆçº§ | å»ºè®®è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|--------|--------------|
| **ç¼ºå°‘å•å…ƒæµ‹è¯•** | é«˜ | å…¨å±€ | P0 | è¡¥å……æµ‹è¯•è¦†ç›–ç‡åˆ°80% |
| **ç¼ºå°‘E2Eæµ‹è¯•** | é«˜ | å…¨å±€ | P0 | å¼•å…¥Playwright/Cypress |
| **APIå±‚ç¼ºå°‘é‡è¯•æœºåˆ¶** | ä¸­ | ç½‘ç»œå±‚ | P1 | æ·»åŠ æŒ‡æ•°é€€é¿é‡è¯• |
| **ç¼ºå°‘æ€§èƒ½ç›‘æ§** | ä¸­ | å…¨å±€ | P1 | é›†æˆAPMå·¥å…· (Sentry) |
| **éƒ¨åˆ†ç»„ä»¶ç¼ºå°‘PropTypes** | ä½ | å±€éƒ¨ | P2 | å®Œå–„TypeScriptç±»å‹ |

### 9.2 æ”¹è¿›å»ºè®®

#### 9.2.1 çŸ­æœŸæ”¹è¿› (1-3ä¸ªæœˆ)

**1. æµ‹è¯•è¦†ç›–ç‡æå‡**

```typescript
// æ·»åŠ å•å…ƒæµ‹è¯•
describe('useAuth', () => {
  it('should login successfully', async () => {
    const { result } = renderHook(() => useAuth());
    await act(() => result.current.login({
      loginId: 'test',
      password: '123'
    }));
    expect(result.current.isAuthenticated).toBe(true);
  });
});
```

**2. æ€§èƒ½ç›‘æ§é›†æˆ**

```typescript
// é›†æˆSentry
import * as Sentry from "@sentry/react";

Sentry.init({
  dsn: "your-dsn",
  integrations: [new Sentry.BrowserTracing()],
  tracesSampleRate: 1.0
});
```

**3. APIé‡è¯•æœºåˆ¶**

```typescript
// Axiosæ‹¦æˆªå™¨æ·»åŠ é‡è¯•
axios.interceptors.response.use(null, async (error) => {
  const config = error.config;

  if (!config || !config.retry) {
    return Promise.reject(error);
  }

  config.retryCount = config.retryCount || 0;

  if (config.retryCount >= config.retry) {
    return Promise.reject(error);
  }

  config.retryCount += 1;
  const backoff = new Promise(resolve => {
    setTimeout(() => resolve(null), config.retryDelay || 1000);
  });

  await backoff;
  return axios(config);
});
```

#### 9.2.2 ä¸­æœŸæ”¹è¿› (3-6ä¸ªæœˆ)

**1. å¾®å‰ç«¯æ¶æ„æ¢ç´¢**

```
ä¸»åº”ç”¨ (SVT-Web)
â”œâ”€â”€ ç³»ç»Ÿç®¡ç†å¾®åº”ç”¨
â”œâ”€â”€ ä¸šåŠ¡ç®¡ç†å¾®åº”ç”¨
â””â”€â”€ æŠ¥è¡¨åˆ†æå¾®åº”ç”¨
```

**2. PWAæ”¯æŒ**

```typescript
// Service Workeræ³¨å†Œ
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js');
}
```

**3. å›½é™…åŒ–æ”¯æŒ**

```typescript
import i18n from 'i18next';

i18n.init({
  resources: {
    en: { translation: { /* English */ } },
    zh: { translation: { /* Chinese */ } }
  }
});
```

---

## åã€æœªæ¥è§„åˆ’

### 10.1 æŠ€æœ¯æ¼”è¿›è·¯çº¿

```
å½“å‰ç‰ˆæœ¬ v1.0.0
    â†“
çŸ­æœŸ (3-6ä¸ªæœˆ)
    â”œâ”€ æµ‹è¯•è¦†ç›–ç‡ â†’ 80%
    â”œâ”€ æ€§èƒ½ç›‘æ§é›†æˆ
    â””â”€ APIé‡è¯•æœºåˆ¶
    â†“
ä¸­æœŸ (6-12ä¸ªæœˆ)
    â”œâ”€ å¾®å‰ç«¯æ¶æ„
    â”œâ”€ PWAæ”¯æŒ
    â””â”€ å›½é™…åŒ–æ”¯æŒ
    â†“
é•¿æœŸ (12-24ä¸ªæœˆ)
    â”œâ”€ GraphQLæ›¿ä»£REST
    â”œâ”€ Kubernetesé›†ç¾¤éƒ¨ç½²
    â””â”€ AIè¾…åŠ©å¼€å‘
```

### 10.2 æ¶æ„æ¼”è¿›æ–¹å‘

**1. ä»å•ä½“åˆ°å¾®æœåŠ¡**

```
å½“å‰: å•ä½“Spring Bootåº”ç”¨
    â†“
æœªæ¥: å¾®æœåŠ¡æ¶æ„
    â”œâ”€â”€ ç”¨æˆ·æœåŠ¡ (user-service)
    â”œâ”€â”€ æƒé™æœåŠ¡ (auth-service)
    â”œâ”€â”€ å®¡è®¡æœåŠ¡ (audit-service)
    â””â”€â”€ ç½‘å…³æœåŠ¡ (gateway-service)
```

**2. ä»æœ¬åœ°ç¼“å­˜åˆ°åˆ†å¸ƒå¼ç¼“å­˜**

```
å½“å‰: Caffeineæœ¬åœ°ç¼“å­˜
    â†“
æœªæ¥: Redisåˆ†å¸ƒå¼ç¼“å­˜ (é«˜å¹¶å‘åœºæ™¯)
```

**3. ä»å…³ç³»å‹æ•°æ®åº“åˆ°æ··åˆå­˜å‚¨**

```
å½“å‰: SQL Server (å…³ç³»å‹)
    â†“
æœªæ¥: SQL Server + Elasticsearch (æœç´¢) + MongoDB (æ–‡æ¡£)
```

### 10.3 å…³é”®æŒ‡æ ‡ç›®æ ‡

| æŒ‡æ ‡ | å½“å‰ | çŸ­æœŸç›®æ ‡ | é•¿æœŸç›®æ ‡ |
|------|------|----------|----------|
| **æµ‹è¯•è¦†ç›–ç‡** | 0% | 80% | 90% |
| **é¦–å±åŠ è½½æ—¶é—´** | 1.2s | 0.8s | 0.5s |
| **APIå“åº”æ—¶é—´(P95)** | 200ms | 150ms | 100ms |
| **å¹¶å‘ç”¨æˆ·æ•°** | 500 | 2000 | 5000 |
| **å¯ç”¨æ€§** | 99.5% | 99.9% | 99.99% |

---

## åä¸€ã€é™„å½•

### 11.1 å…³é”®æ–‡ä»¶ç´¢å¼•

#### åç«¯å…³é”®æ–‡ä»¶

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œæ•° |
|------|----------|------|
| åº”ç”¨å…¥å£ | `SvtApplication.java` | 50 |
| JWTè®¤è¯è¿‡æ»¤å™¨ | `frame/security/filter/JwtAuthenticationFilter.java` | 300 |
| AESåŠ å¯†è¿‡æ»¤å™¨ | `common/filter/AESCryptoFilter.java` | 200 |
| åˆ†å¸ƒå¼é” | `frame/lock/DatabaseDistributedLockManager.java` | 250 |
| åˆ†å¸ƒå¼ID | `frame/dbkey/DistributedIdGenerator.java` | 200 |

#### å‰ç«¯å…³é”®æ–‡ä»¶

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œæ•° |
|------|----------|------|
| åº”ç”¨å…¥å£ | `main.tsx` | 30 |
| è·¯ç”±é…ç½® | `router/index.tsx` | 100 |
| è®¤è¯Store | `stores/authStore.ts` | 150 |
| HTTPå®¢æˆ·ç«¯ | `utils/request.ts` | 200 |
| å¸ƒå±€Provider | `components/Layout/core/LayoutProvider.tsx` | 300 |

### 11.2 APIæ¥å£æ¸…å•

è¯¦è§ Knife4jæ–‡æ¡£: http://localhost:8080/doc.html

**æ ¸å¿ƒæ¥å£:**
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/auth/logout` - ç”¨æˆ·ç™»å‡º
- `POST /api/auth/verify-user-status` - ç”¨æˆ·çŠ¶æ€éªŒè¯
- `POST /api/system/menu/get-all-menu-tree` - è·å–èœå•æ ‘
- `POST /api/system/user/list` - è·å–ç”¨æˆ·åˆ—è¡¨

### 11.3 æ›´æ–°æ—¥å¿—

| æ—¥æœŸ | ç‰ˆæœ¬ | æ›´æ–°å†…å®¹ | ä½œè€… |
|------|------|----------|------|
| 2025-11-17 | 1.0.0 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´ç³»ç»Ÿæ¶æ„æ–‡æ¡£ | Winston (Architect) |

---

## æ–‡æ¡£ç»´æŠ¤

**ç»´æŠ¤å‘¨æœŸ**: æ¯å­£åº¦å®¡æŸ¥ä¸€æ¬¡ï¼Œé‡å¤§æ¶æ„å˜æ›´æ—¶åŠæ—¶æ›´æ–°
**æœ€åæ›´æ–°**: 2025-11-17
**è´Ÿè´£äºº**: Winston (System Architect)
**è”ç³»æ–¹å¼**: architect@svt.example.com

---

**Â© 2025 SVT Project. All rights reserved.**
